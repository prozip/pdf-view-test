<div id="pfd3" class="pf w0 h0" data-page-no="d3"><div class="pc pcd3 w0 h0"><img class="bi x0 y0 w1 h1" alt="" src="bgd3.png"/><div class="t m0 xa0 h14 y80 ff7 fs7 fcb sc0 ls6 ws0">187<span class="_ _10f"></span><span class="ffa">Coupling in Bark</span></div><div class="t m0 x35 h15 yba ff4 fsb fc3 sc0 ls20 ws943">The presentation layer knows very little a<span class="ls34 ws3be">bout the commands it’s hooked up to, and the</span></div><div class="t m0 x35 h15 y16e9 ff4 fsb fc3 sc0 ls5f ws944">commands don’t care why <span class="_ _0"></span>they were trigger<span class="_ _0"></span>ed, as long as they recei<span class="_ _0"></span>ve the data they</div><div class="t m0 x35 h15 y1639 ff4 fsb fc3 sc0 ls1a0 ws26">expe<span class="_ _e"></span>ct. This al<span class="_ _e"></span>lows each l<span class="_ _e"></span>ayer to c<span class="_ _e"></span>hange <span class="ls66 ws83d">independently to adapt to new r<span class="_ _0"></span>equirements.</span></div><div class="t m0 x83 h15 y272 ff4 fsb fc3 sc0 ls3d ws2c0"> Now think about how the busine<span class="_ _e"></span>ss logic la<span class="ls20 ws3e2">yer interacts with the persistence layer.</span></div><div class="t m0 x35 h15 y1158 ff4 fsb fc3 sc0 ls71 ws3c7">Remember the </div><div class="t m5 x39 h24 y16ea ffd fsc fc3 sc0 lsa0 ws0">AddBookmarkC<span class="_ _e"></span>ommand</div><div class="t m0 x6b h15 y1158 ff4 fsb fc3 sc0 ls81 ws945"> you created, sho<span class="_ _e"></span>wn in listing 10.7. This com-</div><div class="t m0 x35 h15 y125 ff4 fsb fc3 sc0 ls20 ws51">mand does the following:</div><div class="t m0 x8a h3d y16eb ffb fs1e fca sc0 ls6 ws0">1</div><div class="t m0 x48 h15 y53 ff4 fsb fc3 sc0 ls5e ws14a">Receives the data for a bookm<span class="_ _e"></span>ark <span class="ls2f ws23">along with an optional timestamp</span></div><div class="t m0 x8a h3d y16ec ffb fs1e fca sc0 ls6 ws0">2</div><div class="t m0 x48 h15 yc6f ff4 fsb fc3 sc0 ls71 wsd4">Generates a timestamp if needed</div><div class="t m0 x8a h3d y16ed ffb fs1e fca sc0 ls6 ws0">3</div><div class="t m0 x48 h15 y493 ff4 fsb fc3 sc0 ls1c ws10">Tells the persistence layer to store the boo<span class="_ _e"></span>kmark</div><div class="t m0 x8a h3d y16ee ffb fs1e fca sc0 ls6 ws0">4</div><div class="t m0 x48 h15 ycf2 ff4 fsb fc3 sc0 ls2f ws23">Returns a message stating that<span class="ls30 wsbd"> the addition was a success</span></div><div class="t m0 x35 h3b y16ef ffd fs18 fc3 sc0 lsb2 ws0">class<span class="_"> </span>AddBookmarkCommand(Command):</div><div class="t m0 x87 h3b y16f0 ffd fs18 fc3 sc0 lsb2 ws0">def<span class="_"> </span>execute(self,<span class="_"> </span>data,<span class="_"> </span>timestamp=None):</div><div class="t m0 x36 h3b y16f1 ffd fs18 fc3 sc0 lsb2 ws0">data[&apos;date_added&apos;]<span class="_"> </span>=<span class="_"> </span>timestamp<span class="_"> </span>or<span class="_"> </span>datetime.utcnow().isoformat()</div><div class="t m0 x36 h3b y16f2 ffd fs18 fc3 sc0 lsb2 ws0">db.add(&apos;bookmarks&apos;,<span class="_"> </span>data)</div><div class="t m0 x36 h3b y10ff ffd fs18 fc3 sc0 lsb2 ws0">return<span class="_"> </span>&apos;Bookmark<span class="_"> </span>added!&apos;</div><div class="t m0 xa7 h20 y16f3 ffb fs7 fc4 sc0 ls6 ws0">Command for adding a new bookmark<span class="_ _110"></span>Listing<span class="_"> </span>10.7</div><div class="c x35 yefc wcf hc2"><div class="t m0 xf4 h36 yefd ff11 fs1c fc12 sc0 ls6 ws0">Presentation layer</div><div class="t m0 xf3 h36 yefe ff11 fs1c fc12 sc0 ls6 ws0">Business logic layer</div><div class="t m0 x13c h36 yeff ff11 fs1c fc12 sc0 ls6 ws0">Persistence layer</div><div class="t m6 xd8 h40 y16f4 ff12 fs1f fc12 sc0 ls6 ws0">User sees and</div><div class="t m6 xd8 h40 y16f5 ff12 fs1f fc12 sc0 ls6 ws0">chooses options.</div><div class="t m6 xd8 h40 y16f6 ff12 fs1f fc12 sc0 ls6 ws4f7">Options trigger</div><div class="t m6 xd8 h40 y16f7 ff12 fs1f fc12 sc0 ls6 ws0">commands.</div><div class="t m6 xd8 h40 y16f8 ff12 fs1f fc12 sc0 ls6 ws0">Commands fetch</div><div class="t m6 xd8 h40 y16f9 ff12 fs1f fc12 sc0 ls6 ws0">and manipulate data.</div></div><div class="c x35 y12d9 w2 h152"><div class="t m0 x46 h2b y16fa ffb fs18 fcb sc0 ls16 ws523">Figure 10.6<span class="_ _29"> </span>Separating concerns </div><div class="t m0 x46 h2b y16fb ffb fs18 fcb sc0 ls6a ws655">into a multitier architecture</div></div><div class="c x30 y16fc wd0 h56"><div class="t m0 x12e h14 y16fd ff12 fs7 fcb sc0 lsda ws311">Receives book<span class="ff13 ls6 ws0">m<span class="ff12">a</span>r</span><span class="ls11a ws3a4">k data</span></div></div><div class="c x120 y16fe wd1 h153"><div class="t m0 x149 h14 y11c8 ff12 fs7 fcb sc0 ls145 ws0">Ge<span class="ff13 ls6">n<span class="ff12">e</span>r</span><span class="ls181 ws5be">ates a</span></div><div class="t m0 x12b h14 y11c9 ff12 fs7 fcb sc0 lsd2 ws0">ti<span class="ff13 ls6">m</span><span class="lsd5">esta<span class="ff13 ls6">m</span><span class="ls88 ws314">p if </span><span class="ff13 ls6">n</span><span class="lsff">eeded</span></span></div></div><div class="c x19 y16ff wd2 h13e"><div class="t m0 x0 h14 y1700 ff12 fs7 fcb sc0 ls88 ws0">Pe<span class="ff13 ls6">r</span><span class="lsd9 ws946">sists the</span></div><div class="t m0 x14d h14 y1701 ff12 fs7 fcb sc0 lsed ws0">book<span class="ff13 ls6">m<span class="ff12">a</span>r<span class="ff12">k</span></span></div><div class="t m0 xfd h14 y1702 ff12 fs7 fcb sc0 ls12f ws0">data</div></div><div class="c xb9 y1703 wd3 he7"><div class="t m0 xb5 h14 y1704 ff12 fs7 fcb sc0 ls19d ws0">Retu<span class="ff13 ls123">rn</span><span class="ls10d ws947">s a success </span></div><div class="t m0 xb5 h14 y1705 ff13 fs7 fcb sc0 ls6 ws0">m<span class="ff12 ls111">essage</span></div></div><div class="t m0 x35 h15 y1706 ff4 fsb fcd sc0 ls6 ws0">What </div><div class="t m3 x0 h22 y1706 ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 x48 h15 y1706 ff4 fsb fcd sc0 ls6 ws0">if </div><div class="t m3 x0 h22 y1706 ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 x3d h15 y1706 ff4 fsb fcd sc0 ls6 ws0">I </div><div class="t m3 x0 h22 y1706 ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 x15 h15 y1706 ff4 fsb fcd sc0 ls6 ws0">told </div><div class="t m3 x0 h22 y1706 ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 x17 h15 y1706 ff4 fsb fcd sc0 ls6 ws0">you </div><div class="t m3 x0 h22 y1706 ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 x1e h15 y1706 ff4 fsb fcd sc0 ls6 ws0">there’s </div><div class="t m3 x0 h22 y1706 ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 x68 h15 y1706 ff4 fsb fcd sc0 ls6 ws0">some </div><div class="t m3 x0 h22 y1706 ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 x12d h15 y1706 ff4 fsb fcd sc0 ls6 ws0">tight </div><div class="t m3 x0 h22 y1706 ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 x64 h15 y1706 ff4 fsb fcd sc0 ls6 ws0">coupling </div><div class="t m3 x0 h22 y1706 ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 x75 h15 y1706 ff4 fsb fcd sc0 ls6 ws0">in </div><div class="t m3 x0 h22 y1706 ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 xe8 h15 y1706 ff4 fsb fcd sc0 ls6 ws0">here? </div><div class="t m3 x0 h22 y1706 ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 x104 h15 y1706 ff4 fsb fcd sc0 ls6 ws0">The </div><div class="t m3 x0 h22 y1706 ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 x5 h15 y1706 ff4 fsb fcd sc0 ls6 ws0">whole </div><div class="t m3 x0 h22 y1706 ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 x7d h15 y1706 ff4 fsb fcd sc0 ls6 ws0">class </div><div class="t m3 x0 h22 y1706 ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 xec h15 y1706 ff4 fsb fcd sc0 ls6 ws0">is </div><div class="t m3 x0 h22 y1706 ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 xfc h15 y1706 ff4 fsb fcd sc0 ls6 ws0">five </div><div class="t m3 x0 h22 y1706 ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 x11b h15 y1706 ff4 fsb fcd sc0 ls6 ws0">lines</div><div class="t m3 x0 h22 y1706 ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 x35 h15 y1707 ff4 fsb fcd sc0 ls6 ws0">long—you <span class="_ _f"></span>might <span class="_ _e"></span>as<span class="_ _e"></span>k <span class="_ _e"></span>yourself, <span class="_ _f"></span>“How <span class="_ _e"></span>much<span class="_ _e"></span> <span class="_ _e"></span>coupling <span class="_ _f"></span>can <span class="_ _e"></span>ther<span class="_ _e"></span>e <span class="_ _e"></span>be <span class="_ _f"></span>in <span class="_ _e"></span>five <span class="_ _f"></span>lines?” <span class="_ _e"></span>As <span class="_ _f"></span>it</div><div class="t m3 x0 h22 y1707 ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 x35 h15 y1708 ff4 fsb fcd sc0 ls6 ws0">turns out, the last two line<span class="_ _e"></span>s of the</div><div class="t m3 x0 h22 y1708 ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m4 x10b h24 y1709 ffd fsc fcd sc0 ls6 ws0">execu<span class="_ _0"></span>te</div><div class="t m3 x0 h25 y1709 ff8 fsc fcd sc0 ls6 ws0"> </div><div class="t m0 x40 h15 y1709 ff4 fsb fcd sc0 ls6 ws0">method show signs</div><div class="t m3 x0 h22 y1709 ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 x5 h15 y1709 ff4 fsb fcd sc0 ls6 ws0">of tight coupling.</div><div class="t m3 x0 h22 y170a ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m3 x0 h22 y170a ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 x8a h15 y170a ff4 fsb fcd sc0 ls6 ws0">The first offending <span class="_ _0"></span>line, <span class="_ _0"></span>which calls</div><div class="t m3 x0 h22 y170a ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m4 x4e h24 y170b ffd fsc fcd sc0 ls6 ws0">db.add</div><div class="t m0 x6d h15 y170b ff4 fsb fcd sc0 ls6 ws0">, demonstrates <span class="_ _0"></span>a tight <span class="_ _1d"></span>co<span class="_ _e"></span>upling <span class="_ _0"></span>with not</div><div class="t m3 x0 h22 y170b ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 x35 h15 y170c ff4 fsb fcd sc0 ls6 ws0">just the <span class="_ _e"></span>persistence layer, but<span class="_ _e"></span> the database <span class="_ _e"></span>itself. Put another <span class="_ _e"></span>way, if you <span class="_ _e"></span>decide in the</div><div class="t m3 x0 h22 y170c ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 x35 h15 y170d ff4 fsb fcd sc0 ls6 ws0">future <span class="_ _e"></span>that <span class="_ _e"></span>you’d <span class="_ _e"></span>like <span class="_ _e"></span>to <span class="_ _e"></span>store <span class="_ _e"></span>your<span class="_ _e"></span> boo<span class="_ _e"></span>kmarks <span class="_ _e"></span>in s<span class="_ _e"></span>omething <span class="_ _e"></span>other <span class="_ _e"></span>than <span class="_ _e"></span>a <span class="_ _e"></span>database—</div><div class="t m3 x0 h22 y170d ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 x35 h15 y170e ff4 fsb fcd sc0 ls6 ws0">like <span class="_ _f"></span>a <span class="_ _e"></span>JSON <span class="_ _f"></span>file, <span class="_ _f"></span>for <span class="_ _e"></span>example—</div><div class="t m4 x63 h24 y170f ffd fsc fcd sc0 ls6 ws0">db.ad<span class="_ _0"></span>d</div><div class="t m3 x0 h25 y170f ff8 fsc fcd sc0 ls6 ws0"> </div><div class="t m0 xa1 h15 y170f ff4 fsb fcd sc0 ls6 ws0">doesn’t <span class="_ _f"></span>fit <span class="_ _e"></span>well <span class="_ _f"></span>any <span class="_ _f"></span>longer. <span class="_ _e"></span>The<span class="_ _e"></span>re’s <span class="_ _e"></span>also <span class="_ _f"></span>some</div><div class="t m3 x0 h22 y170f ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 x35 h15 y1710 ff4 fsb fcd sc0 ls6 ws0">feature <span class="_ _f"></span>envy <span class="_ _f"></span>going <span class="_ _f"></span>on; <span class="_ _f"></span>most <span class="_ _f"></span>of <span class="_ _f"></span>the <span class="_ _f"></span>com<span class="_ _e"></span>mands <span class="_ _f"></span>make <span class="_ _f"></span>direct <span class="_ _f"></span>use <span class="_ _f"></span>of <span class="_ _f"></span>one <span class="_ _f"></span>of <span class="_ _f"></span>the <span class="_ _f"></span>opera-</div><div class="t m3 x0 h22 y1710 ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 x35 h15 y1711 ff4 fsb fcd sc0 ls6 ws0">tions from</div><div class="t m3 x0 h22 y1711 ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m4 x1c h24 y1712 ffd fsc fcd sc0 ls6 ws0">Databa<span class="_ _0"></span>seManag<span class="_ _0"></span>er</div><div class="t m0 x101 h15 y1712 ff4 fsb fcd sc0 ls6 ws0">.</div><div class="t m0 x8a h15 y1713 ff4 fsb fcd sc0 ls6 ws0">The second line that presents coupling is the</div><div class="t m3 x0 h22 y1713 ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m4 x52 h24 y1313 ffd fsc fcd sc0 ls6 ws0">retur<span class="_ _0"></span>n</div><div class="t m3 x0 h25 y1313 ff8 fsc fcd sc0 ls6 ws0"> </div><div class="t m0 x49 h15 y1313 ff4 fsb fcd sc0 ls6 ws0">statement. What is its current</div><div class="t m0 x35 h15 y1714 ff4 fsb fcd sc0 ls6 ws0">purpose? <span class="_ _f"></span>It <span class="_ _e"></span>returns <span class="_ _e"></span>a <span class="_ _f"></span>message <span class="_ _e"></span>stating <span class="_ _e"></span>t<span class="_ _e"></span>he</div><div class="t m3 x0 h22 y1714 ff8 fsb fcd sc0 ls6 ws0"> </div><div class="t m0 x2b h15 y1714 ff4 fsb fcd sc0 ls6 ws0">addition <span class="_ _e"></span>was<span class="_ _e"></span> <span class="_ _e"></span>a <span class="_ _e"></span>success. <span class="_ _f"></span>Who <span class="_ _e"></span>is <span class="_ _e"></span>the <span class="_ _e"></span>me<span class="_ _e"></span>ssage</div></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>
