<div id="pf86" class="pf w0 h0" data-page-no="86"><div class="pc pc86 w0 h0"><img class="bi x0 y0 w1 h1" alt="" src="bg86.png"/><div class="t m0 x42 h14 y80 ff7 fs7 fcb sc0 ls6 ws0">110</div><div class="t m0 x66 h2b y1cf ffb fs18 fcb sc0 ls6 ws0">C</div><div class="t m0 x8e h2c y1d0 ffb fs19 fcb sc0 ls185 ws0">HAPTER</div><div class="t m0 xf1 h2b y1cf ffb fs18 fcb sc0 ls8c ws0"> 6</div><div class="t m0 xe4 h2d y80 ffa fs7 fcb sc0 ls6 ws0">Separation of concerns in practice</div><div class="t m0 x44 h15 y40 ff4 fsb fc3 sc0 ls20 ws363">statements to prevent users from doing ma<span class="ls51 ws34a">licious things with specially crafted que-</span></div><div class="t m0 x44 h15 y41 ff4 fsb fc3 sc0 ls3b ws0">ries.</div><div class="t m0 x3c h31 ydb3 ff4 fs1a fc3 sc0 ls6 ws0">1</div><div class="t m0 x83 h15 y41 ff4 fsb fc3 sc0 ls38 ws26"> Update </div><div class="t m5 xc3 h24 y532 ffd fsc fc3 sc0 lsa0 ws0">_execute</div><div class="t m0 x92 h15 y41 ff4 fsb fc3 sc0 ls3d ws2c"> to accept two things:</div><div class="t m0 x86 h29 ydb4 ffe fs17 fca sc0 ls6 ws0"></div><div class="t m0 x87 h15 y141 ff4 fsb fc3 sc0 ls5e ws57">A SQL statement as a string, po<span class="ls51 ws47">ssibly containing placeholders</span></div><div class="t m0 x86 h29 ydb5 ffe fs17 fca sc0 ls6 ws0"></div><div class="t m0 x87 h15 yb6f ff4 fsb fc3 sc0 ls38 ws26">A list of values to fill in th<span class="ls5e ws57">e placeholders in the statement</span></div><div class="t m0 x44 h15 ydb6 ff4 fsb fc3 sc0 ls1c ws266">The method should then execute the statem<span class="ls38 ws256">ent by passing both argum<span class="_ _e"></span>ents to the cur-</span></div><div class="t m0 x44 h15 yd0c ff4 fsb fc3 sc0 ls34 ws0">sor’s </div><div class="t m5 x8a h24 ydb7 ffd fsc fc3 sc0 lsa0 ws0">execute</div><div class="t m0 xc3 h15 yd0c ff4 fsb fc3 sc0 ls25 ws2b9">, which accepts the same arguments. <span class="ls2d ws5a0">It should look so<span class="ls3d ws710">mething like the</span></span></div><div class="t m0 x44 h15 y110 ff4 fsb fc3 sc0 ls44 ws34">following snippet:</div><div class="t m0 x44 h3b y469 ffd fs18 fc3 sc0 lsb2 ws0">def<span class="_"> </span>_execute(self,<span class="_"> </span>statement,<span class="_"> </span>values=None):</div><div class="t m0 x97 h3b ydb8 ffd fs18 fc3 sc0 lsb2 ws0">with<span class="_"> </span>self.connection:</div><div class="t m0 xc3 h3b y46b ffd fs18 fc3 sc0 lsb2 ws0">cursor<span class="_"> </span>=<span class="_"> </span>self.connection.cursor()</div><div class="t m0 xc3 h3b y412 ffd fs18 fc3 sc0 lsb2 ws0">cursor.execute(statement,<span class="_"> </span>values<span class="_"> </span>or<span class="_"> </span>[])</div><div class="t m0 xc3 h3b y413 ffd fs18 fc3 sc0 lsb2 ws0">return<span class="_"> </span>cursor</div><div class="t m0 x44 h15 y9ea ff4 fsb fc3 sc0 ls38 ws180">Now you have a database connection and th<span class="ls3d ws31d">e ability to <span class="_ _e"></span>execute arbitrary statements</span></div><div class="t m0 x44 h15 y257 ff4 fsb fc3 sc0 ls1e ws13">on that connection. Remember that the co<span class="ls1f ws45">nnection is managed for you automatical<span class="_ _0"></span>ly</span></div><div class="t m0 x44 h15 y9ec ff4 fsb fc3 sc0 ls66 ws711">when you creat<span class="_ _0"></span>e a </div><div class="t m5 x3a h24 ydb9 ffd fsc fc3 sc0 lsa0 ws0">DatabaseManag<span class="_ _e"></span>er</div><div class="t m0 xd0 h15 y9ec ff4 fsb fc3 sc0 ls38 ws3dd"> instance, so you don’t need to think about how</div><div class="t m0 x44 h15 y9ed ff4 fsb fc3 sc0 ls1f ws25f">it’s opened and closed, <span class="_ _0"></span>unless you want to <span class="ls80 ws669">change it. Now, statement executio<span class="_ _e"></span>n is man-</span></div><div class="t m0 x44 h15 y9ee ff4 fsb fc3 sc0 ls38 ws24a">aged within the </div><div class="t m5 x1d h24 ydba ffd fsc fc3 sc0 lsa0 ws0">_execute</div><div class="t m0 x29 h15 y9ee ff4 fsb fc3 sc0 ls20 ws1ca"> method, so you also don’t need to think about <span class="ff3 ls30 ws0">how</span><span class="ls2f ws1ed"> a state-</span></div><div class="t m0 x44 h15 yc4 ff4 fsb fc3 sc0 lsb1 ws2e9">ment is execute<span class="_ _0"></span>d; you on<span class="ls2d ws11e">ly need to tell it <span class="ff3 ls70 ws0">what</span><span class="ls3d ws61"> statement to execute. This is the po<span class="_ _e"></span>wer</span></span></div><div class="t m0 x44 h15 ydbb ff4 fsb fc3 sc0 ls34 ws9f">of separating your concerns.</div><div class="t m0 x32 h15 ycf1 ff4 fsb fc3 sc0 ls48 ws712"> Now that you’ve got th<span class="_ _e"></span>ese building blocks, it’s time to develop some <span class="_ _e"></span>database</div><div class="t m0 x44 h15 ycf2 ff4 fsb fc3 sc0 ls11b ws0">interact<span class="_ _e"></span>ions. </div><div class="t m0 x44 h30 ydbc ffb fsc fc2 sc0 ls6 ws0">C</div><div class="t m0 x12c h5a ydbd ffb fs20 fc2 sc0 ls1ab ws0">REATING</div><div class="t m0 x48 h30 ydbc ffb fsc fc2 sc0 ls6 ws0"> </div><div class="t m0 x20 h5a ydbd ffb fs20 fc2 sc0 ls1b5 ws0">TABLES</div><div class="t m0 x44 h15 ydbe ff4 fsb fc3 sc0 ls20 ws51">One of the first things you’ll need is a data<span class="ls5e ws14a">base table<span class="_ _e"></span> in which to store your bookmark</span></div><div class="t m0 x44 h15 ydbf ff4 fsb fc3 sc0 lsae ws1bf">data. You’ll have to<span class="_ _0"></span> <span class="ff3 ls7d ws0">create</span><span class="ls48 ws68b"> this table using a SQL<span class="_ _e"></span> statement. Because the concerns of</span></div><div class="t m0 x44 h15 y355 ff4 fsb fc3 sc0 ls71 ws15e">connecting to the database and executing st<span class="ls42 ws2f3">atements are now abstracted, the work of</span></div><div class="t m0 x44 h15 ydc0 ff4 fsb fc3 sc0 ls42 ws32">creating a table includes the following:</div><div class="t m0 xbc h3d ydc1 ffb fs1e fca sc0 ls6 ws0">1</div><div class="t m0 x87 h15 ydc2 ff4 fsb fc3 sc0 ls2d ws31">Determine the column names for the table.</div><div class="t m0 xbc h3d ydc3 ffb fs1e fca sc0 ls6 ws0">2</div><div class="t m0 x87 h15 ydc4 ff4 fsb fc3 sc0 ls48 ws39">Determine the data type of e<span class="_ _e"></span>ach column.</div><div class="t m0 xbc h3d ydc5 ffb fs1e fca sc0 ls6 ws0">3</div><div class="t m0 x87 h15 ydc6 ff4 fsb fc3 sc0 ls9e ws285">Construct the ri<span class="_ _0"></span>ght SQL statement to cre<span class="_ _0"></span>ate a table with those<span class="_ _0"></span> columns.</div><div class="t m0 x44 h15 yd65 ff4 fsb fc3 sc0 ls3a ws1c2">Remember that each bookmark has an ID, titl<span class="ls1c ws1c4">e, URL, optional notes, and the date it</span></div><div class="t m0 x44 h15 yd66 ff4 fsb fc3 sc0 ls5f ws59">was added. The data type and co<span class="_ _0"></span><span class="ls2d ws31">nstraints for each column follow:</span></div><div class="t m0 x86 h29 ydc7 ffe fs17 fca sc0 ls6 ws0"></div><div class="t m0 x87 h15 ydc8 ff3 fsb fc3 sc0 ls1a1 ws0">ID<span class="_ _f"></span><span class="ff4 lsc5 ws713">—The ID is the </span><span class="ls1c ws10">primary key<span class="ff4 ls1a5 ws714"> of the ta<span class="_ _0"></span>ble, or the<span class="_ _0"></span> main <span class="ls6 ws5a4">identifier of each re<span class="_ _e"></span>cord.</span></span></span></div><div class="t m0 x87 h15 ydc9 ff4 fsb fc3 sc0 ls36 ws154">It should automatically increment <span class="_ _0"></span>each <span class="ls2d ws5a0">time a new record is added, using the</span></div><div class="t m5 x87 h24 ydca ffd fsc fc3 sc0 lsa0 ws0">AUTOINCREMENT</div><div class="t m0 xb1 h15 ydcb ff4 fsb fc3 sc0 ls51 ws47"> keyword. This column is an </div><div class="t m5 x75 h24 ydca ffd fsc fc3 sc0 lsa0 ws0">INTEGER</div><div class="t m0 x49 h15 ydcb ff4 fsb fc3 sc0 ls1c ws21"> type; the rest are </div><div class="t m5 xec h24 ydca ffd fsc fc3 sc0 lsa0 ws0">TEXT</div><div class="t m0 x9 h15 ydcb ff4 fsb fc3 sc0 ls6 ws0">.</div><div class="t m0 x86 h29 ydcc ffe fs17 fca sc0 ls6 ws0"></div><div class="t m0 x87 h15 y363 ff3 fsb fc3 sc0 ls20 ws0">Title<span class="_ _f"></span><span class="ff4 ws82">—The title is required because it’s ha<span class="ls1b6 ws361">rd to sk<span class="_ _0"></span>im yo<span class="_ _0"></span>ur ex<span class="_ _0"></span>isti<span class="_ _0"></span>ng b<span class="_ _0"></span>ookma<span class="_ _0"></span>rks<span class="_ _0"></span> if</span></span></div><div class="t m0 x87 h15 y365 ff4 fsb fc3 sc0 ls3a wsc3">they’re only URLs. You can tell SQLite <span class="ls30 ws250">the column can’t be empt<span class="_ _e"></span>y by using the</span></div><div class="t m5 x87 h24 y367 ffd fsc fc3 sc0 lsa0 ws0">NOT NULL</div><div class="t m0 x18 h15 y368 ff4 fsb fc3 sc0 ls47 ws38"> keyword.</div><div class="c x10 ydcd w5e hca"><div class="t m0 x12e h14 ydce ff12 fs7 fcb sc0 lsff ws38b">values is optio<span class="ff13 ls6 ws0">n</span><span class="ls140 ws715">al; so<span class="ff13 ls6 ws0">m</span><span class="lsd6 ws3da">e state<span class="ff13 ls6 ws0">m<span class="ff12">e</span>n<span class="ff12 lsec">ts </span></span></span></span></div><div class="t m0 x12e h14 ydcf ff12 fs7 fcb sc0 lsec ws0">do<span class="ff13 ls6">n</span><span class="ls150 ws4f8">’t have placeholde</span><span class="ff13 ls6">r</span><span class="ls10a ws339">s to <span class="_ _0"></span>fill i<span class="ff13 ls6 ws0">n<span class="ff12">.</span></span></span></div></div><div class="c x113 ydd0 w5f hcb"><div class="t m0 x42 h14 ydd1 ff12 fs7 fcb sc0 lsff ws38b">Executes the state<span class="ff13 ls6 ws0">m<span class="ff12">e</span>n<span class="ff12 ls145">t, </span></span></div><div class="t m0 x42 h14 ydd2 ff12 fs7 fcb sc0 ls6 ws0">p<span class="ff13">r</span><span class="ls140">ovidi</span><span class="ff13">n</span><span class="lse1">g a</span><span class="ff13">n</span><span class="lsff ws38b">y passed-i</span><span class="ff13">n</span> </div><div class="t m0 x42 h14 ydd3 ff12 fs7 fcb sc0 lsee ws2cf">values to the placeholde<span class="ff13 ls6 ws0">r<span class="ff12">s</span></span></div></div><div class="t m0 x42 h32 y210 ff4 fs1b fcd sc0 ls6 ws0">1</div><div class="t m0 x43 h33 y211 ff4 fs17 fcd sc0 ls6 ws0">See the Wikip<span class="_ _e"></span>edia article on SQL injectio<span class="_ _e"></span>n:</div><div class="t m3 x0 h34 y211 ff8 fs17 fcd sc0 ls6 ws0"> </div><div class="t m0 xe4 h33 y211 ff4 fs17 fcf sc0 ls6 ws0">https://en.wi<span class="_ _e"></span>kipedia.org/wiki/SQL_injec<span class="_ _e"></span>tion<span class="fcd">.</span></div><a class="l" href="https://en.wikipedia.org/wiki/SQL_injection"><div class="d m2" style="border-style:none;position:absolute;left:222.480000px;bottom:62.378000px;width:170.160000px;height:10.440000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>
