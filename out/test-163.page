<div id="pfa3" class="pf w0 h0" data-page-no="a3"><div class="pc pca3 w0 h0"><img class="bi x0 y0 w1 h1" alt="" src="bga3.png"/><div class="t m0 xa0 h14 y80 ff7 fs7 fcb sc0 ls6 ws0">139<span class="_ _c2"></span><span class="ffa">An exercise in extension</span></div><div class="t m0 x35 h15 y40 ff4 fsb fc3 sc0 ls8a ws33a">The command that gets triggere<span class="_ _e"></span>d must use the GitHub API to fetch the star data.</div><div class="t m0 x9f h31 y1176 ff4 fs1a fc3 sc0 ls6 ws0">3</div><div class="t m0 xdb h15 y40 ff4 fsb fc3 sc0 ls1e0 ws80e"> I rec-</div><div class="t m0 x35 h15 y41 ff4 fsb fc3 sc0 ls15b ws80f">ommend installing and using the requests <span class="_ _0"></span>package (<span class="fcc ls3e ws0">https://github.com/psf/requests<span class="_ _0"></span><span class="fc3 ls79">).</span></span></div><div class="t m0 x83 h15 y42 ff4 fsb fc3 sc0 ls48 ws39"> The star data is paginated, so the<span class="_ _e"></span> proc<span class="ls20 ws17">ess will look somethin<span class="ls25 ws1e1">g like the following:</span></span></div><div class="t m0 x8a h3d y1177 ffb fs1e fca sc0 ls6 ws0">1</div><div class="t m0 x48 h15 y142 ff4 fsb fc3 sc0 ls1e ws2b8">Get the initial page of star results. (T<span class="ls36 ws73b">he endpoint is htt<span class="_ _e"></span>ps://api.github.com/</span></div><div class="t m0 x48 h15 y143 ff4 fsb fc3 sc0 ls36 ws0">users/{github_username}/starred.)</div><div class="t m0 x8a h3d y1178 ffb fs1e fca sc0 ls6 ws0">2</div><div class="t m0 x48 h15 y3f2 ff4 fsb fc3 sc0 ls20 wsb0">Parse the data from the respon<span class="ls3d ws710">se, using it to execute an </span></div><div class="t m5 x5c h24 y1179 ffd fsc fc3 sc0 lsa0 ws0">AddBookmarkCo<span class="_ _e"></span>mmand</div><div class="t m0 x48 h15 y117a ff4 fsb fc3 sc0 ls44 ws34">for each starred repository.</div><div class="t m0 x8a h3d y117b ffb fs1e fca sc0 ls6 ws0">3</div><div class="t m0 x48 h15 y117c ff4 fsb fc3 sc0 ls5f ws59">Get the </div><div class="t m5 x17 h24 y117d ffd fsc fc3 sc0 lsa0 ws413">Link: &lt;…&gt;; rel=next</div><div class="t m0 x121 h15 y117c ff4 fsb fc3 sc0 ls20 ws51"> header, if present.</div><div class="t m0 x8a h3d y117e ffb fs1e fca sc0 ls6 ws0">4</div><div class="t m0 x48 h15 ydd8 ff4 fsb fc3 sc0 ls1c ws10">Repeat for the next page if there is one; otherwise,<span class="_ _e"></span> stop.</div><div class="t m0 x83 h49 y117f ffb fs17 fc2 sc0 lsf7 ws0">NOTE</div><div class="t m0 xaf h15 y3f5 ff4 fsb fc3 sc0 ls30 ws219">To get the timestamps for GitHub stars, you have to pass an </div><div class="t m5 xdc h24 y6ea ffd fsc fc3 sc0 lsa0 ws0">Accept:</div><div class="t m5 x83 h24 y56e ffd fsc fc3 sc0 lsa0 ws0">application/v<span class="_ _e"></span>nd.github.v3.star+json</div><div class="t m0 x10e h15 y56d ff4 fsb fc3 sc0 ls50 ws379"> header in your <span class="_ _0"></span>API requests.</div><div class="t m0 x35 h15 y1180 ff4 fsb fc3 sc0 lsab ws1aa">From the user<span class="_ _0"></span>’s perspective, t<span class="_ _0"></span>he interactio<span class="_ _0"></span><span class="ls51 ws10c">n should look somethin<span class="ls35 ws810">g like the following:</span></span></div><div class="t m0 x35 h3b y570 ffd fs18 fc3 sc0 lsb2 ws0">$<span class="_"> </span>./bark.py</div><div class="t m0 x35 h3b y571 ffd fs18 fc3 sc0 lsb2 ws0">(A)<span class="_"> </span>Add<span class="_"> </span>a<span class="_"> </span>bookmark</div><div class="t m0 x35 h3b y572 ffd fs18 fc3 sc0 lsb2 ws0">(B)<span class="_"> </span>List<span class="_"> </span>bookmarks<span class="_"> </span>by<span class="_"> </span>date</div><div class="t m0 x35 h3b y1181 ffd fs18 fc3 sc0 lsb2 ws0">(T)<span class="_"> </span>List<span class="_"> </span>bookmarks<span class="_"> </span>by<span class="_"> </span>title</div><div class="t m0 x35 h3b y1182 ffd fs18 fc3 sc0 lsb2 ws0">(D)<span class="_"> </span>Delete<span class="_"> </span>a<span class="_"> </span>bookmark</div><div class="t m0 x35 h3b y1183 ffd fs18 fc3 sc0 lsb2 ws0">(G)<span class="_"> </span>Import<span class="_"> </span>GitHub<span class="_"> </span>stars</div><div class="t m0 x35 h3b y1184 ffd fs18 fc3 sc0 lsb2 ws0">(Q)<span class="_"> </span>Quit</div><div class="t m0 x35 h3b y70c ffd fs18 fc3 sc0 lsb2 ws0">Choose<span class="_"> </span>an<span class="_"> </span>option:<span class="_"> </span>G</div><div class="t m0 x35 h3b y1185 ffd fs18 fc3 sc0 lsb2 ws0">GitHub<span class="_"> </span>username:<span class="_"> </span>daneah</div><div class="t m0 x35 h3b y1186 ffd fs18 fc3 sc0 lsb2 ws0">Preserve<span class="_"> </span>timestamps<span class="_"> </span>[Y/n]:<span class="_"> </span>Y</div><div class="t m0 x35 h3b y1187 ffd fs18 fc1 sc0 lsb2 ws0">Imported<span class="_"> </span>205<span class="_"> </span>bookmarks<span class="_"> </span>from<span class="_"> </span>starred<span class="_"> </span>repos!</div><div class="t m0 x35 h15 y28f ff4 fsb fc3 sc0 ls48 ws2da">It turns out that Bark, as written, isn’t <span class="ff3 ls25 ws0">perfectly</span><span class="ls1c ws4af"> extensible, particularly regarding book-</span></div><div class="t m0 x35 h15 y290 ff4 fsb fc3 sc0 ls31 wsb5">mark timestamps. Currently, <span class="ls4e ws2fe">Bark forces the timestam<span class="_ _e"></span>p to be the time the bookmark</span></div><div class="t m0 x35 h15 ybd1 ff4 fsb fc3 sc0 ls3b ws811">is created (using </div><div class="t m5 x1e h24 y1188 ffd fsc fc3 sc0 lsa0 ws0">datetime.da<span class="_ _e"></span>tetime.utcnow().isoforma<span class="_ _e"></span>t()</div><div class="t m0 x33 h15 ybd1 ff4 fsb fc3 sc0 ls1c ws812">), but you want the</div><div class="t m0 x35 h15 y292 ff4 fsb fc3 sc0 ls48 ws3f5">option to preserve the tim<span class="_ _e"></span>estamps of GitH<span class="ls44 ws14b">ub stars. You can improve this by using</span></div><div class="t m0 x35 h15 y293 ff4 fsb fc3 sc0 ls2d ws31">inversion of control.</div><div class="t m0 x83 h15 y294 ff4 fsb fc3 sc0 lsae ws813"> Try updating the </div><div class="t m5 xba h24 y1189 ffd fsc fc3 sc0 lsa0 ws0">AddBookmarkCom<span class="_ _e"></span>mand</div><div class="t m0 x2b h15 y294 ff4 fsb fc3 sc0 ls38 ws424"> to accept an optional<span class="ls1c ws3e2"> timestamp, using its</span></div><div class="t m0 x35 h15 ybd3 ff4 fsb fc3 sc0 ls51 ws47">original behavior as the fallback. Check the following listing to see how you did.</div><div class="t m0 x35 h3b y118a ffd fs18 fc3 sc0 lsb2 ws0">class<span class="_"> </span>AddBookmarkCommand: </div><div class="t m0 x87 h3b y118b ffd fs18 fc3 sc0 lsb2 ws0">def<span class="_"> </span>execute(self,<span class="_"> </span>data,<span class="_"> </span>timestamp=None):</div><div class="t m0 x36 h3b y1105 ffd fs18 fc3 sc0 lsb2 ws0">data[&apos;date_added&apos;]<span class="_"> </span>=<span class="_"> </span>timestamp<span class="_"> </span>or<span class="_"> </span>datetime.utcnow().isoformat()</div><div class="t m0 x36 h3b y118c ffd fs18 fc3 sc0 lsb2 ws0">db.add(&apos;bookmarks&apos;,<span class="_"> </span>data)</div><div class="t m0 x36 h3b y1107 ffd fs18 fc1 sc0 lsb2 ws0">return<span class="_"> </span>&apos;Bookmark<span class="_"> </span>added!&apos;</div><div class="t m0 x83 h20 y118d ffb fs7 fc4 sc0 ls6 ws0">Listing<span class="_"> </span>7.7<span class="_ _55"> </span>Inverting control of the timestamp for a bookm<span class="_ _0"></span>ark</div><div class="c x5f y118e w9 h79"><div class="t m0 x12e h14 ye95 ff12 fs7 fcb sc0 ls10a ws470">Adds a<span class="ff13 ls6 ws0">n</span><span class="ls125 ws3cc"> optio<span class="ff13 ls6 ws0">n</span><span class="ls88 ws2d0">al ti<span class="ff13 ls6 ws0">m<span class="ff12 ls113">esta</span>m<span class="ff12 lsec">p </span></span></span></span></div><div class="t m0 x12e h14 ye96 ff12 fs7 fcb sc0 ls6 ws0">a<span class="ff13">r</span><span class="lsdd">gu</span><span class="ff13">m</span>e<span class="ff13">n</span><span class="ws317">t to execute</span></div></div><div class="c x89 y118f w90 hfb"><div class="t m0 x128 h14 y1190 ff12 fs7 fcb sc0 lsd6 ws3da">Uses the passed-i<span class="ff13 ls6 ws0">n</span><span class="lsf2 ws65e"> ti<span class="ff13 ls6 ws0">m<span class="ff12 lsd5">esta</span>m</span><span class="lsd2 ws35c">p if p<span class="ff13 ls6 ws0">r<span class="ff12 ls124">ovided,</span></span></span></span></div><div class="t m0 xd2 h14 y1191 ff12 fs7 fcb sc0 lsff ws0">usi<span class="ff13 ls6">n</span><span class="ls11a ws3a4">g the cu</span><span class="ff13 ls103">rr</span><span class="ls6">e<span class="ff13">n</span><span class="lsd2 ws35c">t ti</span><span class="ff13">m</span><span class="ls199 ws814">e as a fallback</span></span></div></div><div class="t m0 x19 h32 y210 ff4 fs1b fcd sc0 ls6 ws0">3</div><div class="t m0 x34 h33 y211 ff4 fs17 fcd sc0 ls6 ws0">Learn about GitH<span class="_ _e"></span>ub’s starred repositorie<span class="_ _e"></span>s API at</div><div class="t m3 x0 h34 y211 ff8 fs17 fcd sc0 ls6 ws0"> </div><div class="t m0 xb3 h33 y211 ff4 fs17 fcf sc0 ls6 ws0">http://mng.bz/<span class="_ _e"></span>lony<span class="fcd">.</span></div><a class="l" href="http://mng.bz/lony"><div class="d m2" style="border-style:none;position:absolute;left:251.160000px;bottom:62.378000px;width:75.660000px;height:10.440000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="https://github.com/psf/requests"><div class="d m2" style="border-style:none;position:absolute;left:321.240000px;bottom:588.518000px;width:145.920000px;height:11.220000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>
