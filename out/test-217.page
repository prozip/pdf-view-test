<div id="pfd9" class="pf w0 h0" data-page-no="d9"><div class="pc pcd9 w0 h0"><img class="bi x0 y0 w1 h1" alt="" src="bgd9.png"/><div class="t m0 xa0 h14 y80 ff7 fs7 fcb sc0 ls6 ws0">193<span class="_ _37"></span><span class="ffa">Addressi<span class="_ _0"></span>ng coupling</span></div><div class="t m0 x8b h29 y33a ffe fs17 fca sc0 ls6 ws0"></div><div class="t m5 x48 h24 y3eb ffd fsc fc3 sc0 lsa0 ws0">__init__</div><div class="t m0 xa7 h15 y40 ff4 fsb fc3 sc0 ls36 ws35"> for initial configuration </div><div class="t m0 x8b h29 ydd4 ffe fs17 fca sc0 ls6 ws0"></div><div class="t m5 x48 h24 y6e3 ffd fsc fc3 sc0 lsa0 ws0">create(data)</div><div class="t m0 xb9 h15 y6e4 ff4 fsb fc3 sc0 ls3a ws28"> to create a new bookmark</div><div class="t m0 x8b h29 ydd5 ffe fs17 fca sc0 ls6 ws0"></div><div class="t m5 x48 h24 ydd7 ffd fsc fc3 sc0 lsa0 ws0">list(order_by<span class="_ _e"></span>)</div><div class="t m0 xbe h15 ydd6 ff4 fsb fc3 sc0 ls42 ws32"> to list all bookmarks </div><div class="t m0 x8b h29 y17a8 ffe fs17 fca sc0 ls6 ws0"></div><div class="t m5 x48 h24 y17a9 ffd fsc fc3 sc0 lsa0 ws0">edit(bookmark<span class="_ _e"></span>_id, data)</div><div class="t m0 xc h15 y464 ff4 fsb fc3 sc0 ls1f ws14"> to update a bookmark </div><div class="t m0 x8b h29 y17aa ffe fs17 fca sc0 ls6 ws0"></div><div class="t m5 x48 h24 y17ab ffd fsc fc3 sc0 lsa0 ws0">delete(bookma<span class="_ _e"></span>rk_id)</div><div class="t m0 x101 h15 y143 ff4 fsb fc3 sc0 ls20 ws17"> to remove a bookmark </div><div class="t m0 x35 h15 y17ac ff4 fsb fc3 sc0 ls30 ws49b">The logic in </div><div class="t m5 x18 h24 y17ad ffd fsc fc3 sc0 lsa0 ws0">CreateBookma<span class="_ _e"></span>rksTableCommand</div><div class="t m0 x50 h15 y17ac ff4 fsb fc3 sc0 ls2f ws3e4"> is really the initial configuration for <span class="_ _0"></span>a</div><div class="t m0 x35 h15 y120d ff4 fsb fc3 sc0 ls25 ws95a">bookmark database persistence layer, so you can move it into </div><div class="t m5 x7d h24 y17ae ffd fsc fc3 sc0 lsa0 ws0">BookmarksData<span class="_ _e"></span>-</div><div class="t m5 x35 h24 y17af ffd fsc fc3 sc0 lsa0 ws0">base.__init__</div><div class="t m0 x28 h15 y17b0 ff4 fsb fc3 sc0 ls42 ws26e">. The instantiation of the </div><div class="t m5 xf h24 y17af ffd fsc fc3 sc0 lsa0 ws0">DatabaseMan<span class="_ _e"></span>ager</div><div class="t m0 x103 h15 y17b0 ff4 fsb fc3 sc0 ls1c ws21"> fits well there too. You can</div><div class="t m0 x35 h15 yad5 ff4 fsb fc3 sc0 ls5e ws14a">then write the implementation for each metho<span class="_ _e"></span>d of the </div><div class="t m5 x4f h24 y17b1 ffd fsc fc3 sc0 lsa0 ws0">PersistenceLay<span class="_ _e"></span>er</div><div class="t m0 xce h15 yad5 ff4 fsb fc3 sc0 ls3a ws28"> abstraction</div><div class="t m0 x35 h15 yba2 ff4 fsb fc3 sc0 ls73 ws0">in </div><div class="t m5 x151 h24 y17b2 ffd fsc fc3 sc0 lsa0 ws0">BookmarksDat<span class="_ _e"></span>abase</div><div class="t m0 xe2 h15 yba2 ff4 fsb fc3 sc0 ls42 ws5e3">. Each database-centric metho<span class="_ _e"></span>d call (</div><div class="t m5 x73 h24 y17b2 ffd fsc fc3 sc0 lsa0 ws0">db.add</div><div class="t m0 xd4 h15 yba2 ff4 fsb fc3 sc0 ls7a ws95b">, for example)</div><div class="t m0 x35 h15 y251 ff4 fsb fc3 sc0 ls2f ws26a">from your original command<span class="ls42 ws26e">s can be moved into the appropriate method, freeing up</span></div><div class="t m0 x35 h15 y1403 ff4 fsb fc3 sc0 ls34 ws9f">the commands to call the methods from </div><div class="t m5 xf h24 y17b3 ffd fsc fc3 sc0 lsa0 ws0">BookmarksDa<span class="_ _e"></span>tabase</div><div class="t m0 x7a h15 y1403 ff4 fsb fc3 sc0 ls1b ws40">. Give this a go<span class="_ _e"></span>, referenc-</div><div class="t m0 x35 h15 yba ff4 fsb fc3 sc0 ls6c ws6f">ing the following<span class="_ _0"></span> listing and the full sour<span class="_ _0"></span>ce code for this chapter as you<span class="_ _0"></span> go along.</div><div class="t m0 x35 h3b y14e8 ffd fs18 fc3 sc0 lsb2 ws0">from<span class="_"> </span>abc<span class="_"> </span>import<span class="_"> </span>ABC,<span class="_"> </span>abstractmethod</div><div class="t m0 x35 h3b y17b4 ffd fs18 fc3 sc0 lsb2 ws0">from<span class="_"> </span>database<span class="_"> </span>import<span class="_"> </span>DatabaseManager</div><div class="t m0 x35 h3b y17b5 ffd fs18 fc3 sc0 lsb2 ws0">class<span class="_"> </span>PersistenceLayer(ABC):</div><div class="t m0 x87 h3b y17b6 ffd fs18 fc3 sc0 lsb2 ws0">@abstractmethod</div><div class="t m0 x87 h3b y17b7 ffd fs18 fc3 sc0 lsb2 ws0">def<span class="_"> </span>create(self,<span class="_"> </span>data):</div><div class="t m0 x36 h3b yb34 ffd fs18 fc3 sc0 lsb2 ws0">raise<span class="_"> </span>NotImplementedError(&apos;Persistence<span class="_"> </span>layers<span class="_"> </span>must<span class="_"> </span>implement<span class="_"> </span>a</div><div class="t m0 x35 h51 y17b8 ff9 fs15 fc9 sc0 ls6 ws0">➥</div><div class="t m0 xae h51 y17b9 ff9 fs15 fc9 sc0 ls6 ws0"> </div><div class="t m0 x83 h3b yb35 ffd fs18 fc3 sc0 lsb2 ws0">create<span class="_"> </span>method&apos;)</div><div class="t m0 x87 h3b yb37 ffd fs18 fc3 sc0 lsb2 ws0">@abstractmethod</div><div class="t m0 x87 h3b yb38 ffd fs18 fc3 sc0 lsb2 ws0">def<span class="_"> </span>list(self,<span class="_"> </span>order_by=None):</div><div class="t m0 x36 h3b y17ba ffd fs18 fc3 sc0 lsb2 ws0">raise<span class="_"> </span>NotImplementedError(&apos;Persistence<span class="_"> </span>layers<span class="_"> </span>must<span class="_"> </span>implement<span class="_"> </span>a</div><div class="t m0 x35 h51 y17bb ff9 fs15 fc9 sc0 ls6 ws0">➥</div><div class="t m0 xae h51 y17bc ff9 fs15 fc9 sc0 ls6 ws0"> </div><div class="t m0 x83 h3b yb39 ffd fs18 fc3 sc0 lsb2 ws0">list<span class="_"> </span>method&apos;)</div><div class="t m0 x87 h3b y17bd ffd fs18 fc3 sc0 lsb2 ws0">@abstractmethod</div><div class="t m0 x87 h3b yb3b ffd fs18 fc3 sc0 lsb2 ws0">def<span class="_"> </span>edit(self,<span class="_"> </span>bookmark_id,<span class="_"> </span>bookmark_data):</div><div class="t m0 x36 h3b yb3c ffd fs18 fc3 sc0 lsb2 ws0">raise<span class="_"> </span>NotImplementedError(&apos;Persistence<span class="_"> </span>layers<span class="_"> </span>must<span class="_"> </span>implement<span class="_"> </span>an</div><div class="t m0 x35 h51 y17be ff9 fs15 fc9 sc0 ls6 ws0">➥</div><div class="t m0 xae h51 y17bf ff9 fs15 fc9 sc0 ls6 ws0"> </div><div class="t m0 x83 h3b y4fd ffd fs18 fc3 sc0 lsb2 ws0">edit<span class="_"> </span>method&apos;)</div><div class="t m0 x87 h3b y4fe ffd fs18 fc3 sc0 lsb2 ws0">@abstractmethod</div><div class="t m0 x87 h3b yb3e ffd fs18 fc3 sc0 lsb2 ws0">def<span class="_"> </span>delete(self,<span class="_"> </span>bookmark_id):</div><div class="t m0 x36 h3b y17c0 ffd fs18 fc3 sc0 lsb2 ws0">raise<span class="_"> </span>NotImplementedError(&apos;Persistence<span class="_"> </span>layers<span class="_"> </span>must<span class="_"> </span>implement<span class="_"> </span>a</div><div class="t m0 x35 h51 y17c1 ff9 fs15 fc9 sc0 ls6 ws0">➥</div><div class="t m0 xae h51 y17c2 ff9 fs15 fc9 sc0 ls6 ws0"> </div><div class="t m0 x83 h3b y4ff ffd fs18 fc3 sc0 lsb2 ws0">delete<span class="_"> </span>method&apos;)</div><div class="t m0 x35 h3b yb41 ffd fs18 fc3 sc0 lsb2 ws0">class<span class="_"> </span>BookmarkDatabase(PersistenceLayer):</div><div class="t m0 x87 h3b y501 ffd fs18 fc3 sc0 lsb2 ws0">def<span class="_"> </span>__init__(self):</div><div class="t m0 x36 h3b y502 ffd fs18 fc3 sc0 lsb2 ws0">self.table_name<span class="_"> </span>=<span class="_"> </span>&apos;bookmarks&apos;</div><div class="t m0 x36 h3b y503 ffd fs18 fc3 sc0 lsb2 ws0">self.db<span class="_"> </span>=<span class="_"> </span>DatabaseManager(&apos;bookmarks.db&apos;)</div><div class="t m0 x83 h20 y17c3 ffb fs7 fc4 sc0 ls6 ws0">Listing<span class="_"> </span>10.10<span class="_ _55"> </span>A persistence interface and implementation</div><div class="c xb3 y17c4 wab h15c"><div class="t m0 x12e h14 ybdd ff12 fs7 fcb sc0 ls100 ws95c">The abst<span class="ff13 ls6 ws0">r</span><span class="ls181 ws95d">act base class that defi<span class="ff13 ls6 ws0">n<span class="ff12 lsd9">es </span></span></span></div><div class="t m0 x12e h14 ybde ff12 fs7 fcb sc0 lsee ws2cf">the pe<span class="ff13 ls6 ws0">r<span class="ff12 ls170">siste</span>n</span><span class="ls12f ws64e">ce laye<span class="ff13 ls6 ws0">r<span class="ff12 lse1"> i</span>n<span class="ff12 lsd2">te</span>r<span class="ff12 lse4">face</span></span></span></div></div><div class="c x4e y17c5 wab h15d"><div class="t m0 x12e h14 y17c6 ff12 fs7 fcb sc0 lsed ws0">Each <span class="ff13 ls6">m</span><span class="lsda ws2aa">ethod co</span><span class="ff13 ls103">rr</span><span class="lse0">espo<span class="ff13 ls6">n</span><span class="ls170">ds </span></span></div><div class="t m0 x12e h14 y17c7 ff12 fs7 fcb sc0 lsff ws38b">to a CRUD-like ope<span class="ff13 ls6 ws0">r<span class="ff12 ls10f">atio</span>n<span class="ff12"> </span></span></div><div class="t m0 x12e h14 y17c8 ff12 fs7 fcb sc0 ls103 ws0">fo<span class="ff13 ls6">r</span><span class="ls181 ws5be"> pe</span><span class="ff13 ls6">r</span><span class="ls127">siste<span class="ff13 ls6">n<span class="ff12">ce.</span></span></span></div></div><div class="c xa1 y17c9 wab h56"><div class="t m0 x12e h14 y68d ff12 fs7 fcb sc0 ls88 ws2d0">A specific pe<span class="ff13 ls6 ws0">r<span class="ff12 ls170">siste</span>n</span><span class="lsff ws315">ce laye<span class="ff13 ls6 ws0">r<span class="ff12"> </span></span></span></div><div class="t m0 x12e h14 y68e ff12 fs7 fcb sc0 ls6 ws0">i<span class="ff13">m</span><span class="lsde">ple</span><span class="ff13">m</span>e<span class="ff13">n</span><span class="ls181">tatio</span><span class="ff13">n</span><span class="ls118 ws690"> that uses a database</span></div></div><div class="c x6d y17ca wac hb3"><div class="t m0 x42 h14 y17cb ff12 fs7 fcb sc0 ls127 ws0">Ha<span class="ff13 ls6">n</span><span class="lsd5 ws2a6">dles database c</span><span class="ff13 ls6">r<span class="ff12">eatio</span>n<span class="ff12"> </span></span></div><div class="t m0 x42 h14 y17cc ff12 fs7 fcb sc0 ls6 ws3a5">with DatabaseMa<span class="ff13 ws0">n<span class="ff12 lse3">age</span>r</span></div></div><div class="t m0 x36 h3b y17cd ffd fs18 fcd sc0 ls6 ws0">self.db.create_table(<span class="_ _e"></span>self.table_name,</div><div class="t m3 x0 h3a y17cd ff8 fs18 fcd sc0 ls6 ws0"> </div><div class="t m0 x14 h3b y17cd ffd fs18 fcd sc0 ls6 ws0">{</div><div class="t m0 xe6 h3b y509 ffd fs18 fcd sc0 ls6 ws0">&apos;id&apos;:</div><div class="t m3 x0 h3a y509 ff8 fs18 fcd sc0 ls6 ws0"> </div><div class="t m0 xd6 h3b y509 ffd fs18 fcd sc0 ls6 ws0">&apos;integer</div><div class="t m3 x0 h3a y509 ff8 fs18 fcd sc0 ls6 ws0"> </div><div class="t m0 x56 h3b y509 ffd fs18 fcd sc0 ls6 ws0">primary</div><div class="t m3 x0 h3a y509 ff8 fs18 fcd sc0 ls6 ws0"> </div><div class="t m0 x64 h3b y509 ffd fs18 fcd sc0 ls6 ws0">key</div><div class="t m3 x0 h3a y509 ff8 fs18 fcd sc0 ls6 ws0"> </div><div class="t m0 x10d h3b y509 ffd fs18 fcd sc0 ls6 ws0">autoincrement&apos;,</div></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>
