<div id="pfc1" class="pf w0 h0" data-page-no="c1"><div class="pc pcc1 w0 h0"><img class="bi x0 y0 w1 h1" alt="" src="bgc1.png"/><div class="t m0 xa0 h14 y80 ff7 fs7 fcb sc0 ls6 ws0">169<span class="_ _f1"></span><span class="ffa">Breaking down complexity</span></div><div class="t m0 x35 h15 y14d ff4 fsb fc3 sc0 ls51 ws3dc">If no function is available after calling </div><div class="t m5 x31 h24 y416 ffd fsc fc3 sc0 lsa0 ws0">formats.get(<span class="_ _e"></span>…)</div><div class="t m0 x147 h15 y14d ff4 fsb fc3 sc0 ls5e ws274">, you should fall back to <span class="_ _e"></span>a func-</div><div class="t m0 x35 h15 y14e ff4 fsb fc3 sc0 ls42 ws1e5">tion that returns the </div><div class="t m5 xba h24 y14fc ffd fsc fc3 sc0 lsa0 ws0">food</div><div class="t m0 x8d h15 y14e ff4 fsb fc3 sc0 ls44 ws593"> value unchanged; this can be done using a <span class="_ _0"></span>lambda. Check</div><div class="t m0 x35 h15 y417 ff4 fsb fc3 sc0 ls38 ws26">the following listing when you’re done.</div><div class="t m0 x35 h3b y119c ffd fs18 fc3 sc0 lsb2 ws0">def<span class="_"> </span>to_json(food):</div><div class="t m0 x87 h3b y119d ffd fs18 fc3 sc0 lsb2 ws0">return<span class="_"> </span>json.dumps({&apos;food&apos;:<span class="_"> </span>food})</div><div class="t m0 x35 h3b y11a0 ffd fs18 fc3 sc0 lsb2 ws0">def<span class="_"> </span>to_xml(food):</div><div class="t m0 x87 h3b y11a3 ffd fs18 fc3 sc0 lsb2 ws0">return<span class="_"> </span>f&apos;&lt;response&gt;&lt;food&gt;{food}&lt;/food&gt;&lt;/response&gt;&apos;</div><div class="t m0 x35 h3b y11a5 ffd fs18 fc3 sc0 lsb2 ws0">def<span class="_"> </span>random_food(request):</div><div class="t m0 x87 h3b y14fd ffd fs18 fc3 sc0 lsb2 ws0">food<span class="_"> </span>=<span class="_"> </span>random.choice(FOODS)</div><div class="t m0 x87 h3b ya16 ffd fs18 fc3 sc0 lsb2 ws0">formats<span class="_"> </span>=<span class="_"> </span>{</div><div class="t m0 x36 h3b y6f4 ffd fs18 fc3 sc0 lsb2 ws0">&apos;application/json&apos;:<span class="_"> </span>to_json,</div><div class="t m0 x36 h3b y6f5 ffd fs18 fc3 sc0 lsb2 ws0">&apos;application/xml&apos;:<span class="_"> </span>to_xml,</div><div class="t m0 x87 h3b ya17 ffd fs18 fc3 sc0 ls6 ws0">}</div><div class="t m0 x87 h3b ya19 ffd fs18 fc3 sc0 lsb2 ws0">format_function<span class="_"> </span>=<span class="_"> </span>formats.get(</div><div class="t m0 x36 h3b y14fe ffd fs18 fc3 sc0 lsb2 ws0">request.headers.get(&apos;Accept&apos;),</div><div class="t m0 x36 h3b y11a6 ffd fs18 fc3 sc0 lsb2 ws0">lambda<span class="_"> </span>val:<span class="_"> </span>val</div><div class="t m0 x87 h3b y11a7 ffd fs18 fc3 sc0 ls6 ws0">)</div><div class="t m0 x87 h3b ya1b ffd fs18 fc3 sc0 lsb2 ws0">return<span class="_"> </span>format_function(food)</div><div class="t m0 x35 h15 y14ff ff4 fsb fc3 sc0 ls2f ws63b">To fully separate the concerns, you can now extract </div><div class="t m5 xe9 h24 y1500 ffd fsc fc3 sc0 lsa0 ws0">formats</div><div class="t m0 x33 h15 y14ff ff4 fsb fc3 sc0 ls44 ws8e"> and the business of</div><div class="t m0 x35 h15 y1501 ff4 fsb fc3 sc0 ls7d ws8d4">getting the right func<span class="ls2f ws40e">tion from it into its own function, </span></div><div class="t m5 x104 h24 y1502 ffd fsc fc3 sc0 lsa0 ws0">get_format_<span class="_ _e"></span>function</div><div class="t m0 x108 h15 y1501 ff4 fsb fc3 sc0 ls5e ws295">. This</div><div class="t m0 x35 h15 y1503 ff4 fsb fc3 sc0 ls30 ws612">function accepts the user’s </div><div class="t m5 x47 h24 y1504 ffd fsc fc3 sc0 lsa0 ws0">Accept</div><div class="t m0 xa5 h15 y1504 ff4 fsb fc3 sc0 ls3a ws6b6"> header value and returns the right formatting</div><div class="t m0 x17 h20 y1505 ffb fs7 fc4 sc0 ls6 ws0">A service endpoint with response-formatting fu<span class="_ _0"></span>nctions<span class="_ _f2"></span>Listing<span class="_"> </span>9.4</div><div class="c x35 y1506 wb5 h133"><div class="t m0 x14d h5f y1507 ff15 fs1c fc12 sc0 ls6 ws0">formats = {</div><div class="t m0 x14d h5f y1508 ff15 fs1c fc12 sc0 ls6 ws0">    &apos;application/json&apos;: json.dumps({&apos;food&apos;: food}),</div><div class="t m0 x14d h5f y1509 ff15 fs1c fc12 sc0 ls6 ws0">    &apos;application/xml&apos;: f&apos;&lt;response&gt;&lt;food&gt;{food}&lt;/food&gt;&lt;/response&gt;&apos;,</div><div class="t m0 x14d h5f y150a ff15 fs1c fc12 sc0 ls6 ws0">}</div><div class="t m0 x14d h5f y150b ff15 fs1c fc12 sc0 ls6 ws0">def to_json(food):</div><div class="t m0 x14d h5f y150c ff15 fs1c fc12 sc0 ls6 ws0">    return json.dumps({&apos;food&apos;: food})</div><div class="t m0 x14d h5f y150d ff15 fs1c fc12 sc0 ls6 ws0">def to_xml(food):</div><div class="t m0 x14d h5f y150e ff15 fs1c fc12 sc0 ls6 ws0">    return f&apos;&lt;response&gt;&lt;food&gt;{food}&lt;/food&gt;&lt;/response&gt;&apos; </div><div class="t m0 x130 h37 y150f ff12 fs1d fc12 sc0 ls6 ws0">The format becomes part</div><div class="t m0 x130 h37 y1510 ff12 fs1d fc12 sc0 ls6 ws0">of the function name.</div><div class="t m0 xbc h37 y150f ff12 fs1d fc12 sc0 ls6 ws0">The food value becomes an</div><div class="t m0 xbc h37 y1510 ff12 fs1d fc12 sc0 ls6 ws0">argument to the function.</div><div class="t m0 x46 h37 y150f ff12 fs1d fc12 sc0 ls6 ws0">The function returns the</div><div class="t m0 x46 h37 y1510 ff12 fs1d fc12 sc0 ls6 ws0">same formatted response.</div></div><div class="c x35 y1511 w2 h134"><div class="t m0 x2 h2b y1512 ffb fs18 fcb sc0 ls69 ws44f">Extracting inline expressions as function<span class="_ _0"></span>s<span class="_ _f3"></span>Figure 9.3</div></div><div class="c x94 y1513 w88 hf1"><div class="t m0 x127 h14 y394 ff12 fs7 fcb sc0 ls10c ws35a">The ext<span class="ff13 ls6 ws0">r</span><span class="lsd2 ws35c">acted fo<span class="ff13 ls123 ws0">rm<span class="ff12 ls11a">atti</span><span class="ls6">n<span class="ff12 lse1">g fu</span>n<span class="ff12 lse4">ctio</span>n<span class="ff12">s</span></span></span></span></div></div><div class="c x63 y1514 wb6 h135"><div class="t m0 x12e h14 y566 ff12 fs7 fcb sc0 lsfd ws310">Maps data fo<span class="ff13 ls103 ws0">rm<span class="ff12 ls140">ats </span></span></div><div class="t m0 x12e h14 y567 ff12 fs7 fcb sc0 ls13c ws46f">to thei<span class="ff13 ls6 ws0">r<span class="ff12"> </span>r<span class="ff12 ls10c">espective </span></span></div><div class="t m0 x12e h14 y68e ff12 fs7 fcb sc0 ls103 ws0">fo<span class="ff13">rm</span><span class="lsdc">atti<span class="ff13 ls6">n</span><span class="lsdd ws4">g fu</span><span class="ff13 ls6">n</span><span class="ls117">ctio<span class="ff13 ls6">n</span><span class="ls10e">s <span class="ff13 ls6">n</span><span class="ls127">ow</span></span></span></span></div></div><div class="c xca y1515 w28 h56"><div class="t m0 x12e h14 yb49 ff12 fs7 fcb sc0 ls13c ws8d5">Gets the app<span class="ff13 ls6 ws0">r<span class="ff12 lse2">op</span>r</span><span class="ls118 ws674">iate f<span class="_ _0"></span>o<span class="ff13 ls123 ws0">rm<span class="ff12 ls11a">atti</span><span class="ls6">n<span class="ff12 lse1">g </span></span></span></span></div><div class="t m0 x12e h14 y480 ff12 fs7 fcb sc0 ls103 ws0">fu<span class="ff13 ls6">n</span><span class="lse4">ctio<span class="ff13 ls6">n</span><span class="lsee ws30e"> if available</span></span></div></div><div class="c x10b y1516 wb7 h46"><div class="t m0 x12e h14 y2f5 ff12 fs7 fcb sc0 ls10c ws3d9">Uses a la<span class="ff13 ls6 ws0">m</span><span class="lsd2 ws35c">bda as the fallback to </span></div><div class="t m0 x12e h14 y2f7 ff13 fs7 fcb sc0 ls6 ws0">r<span class="ff12 ls105">etu</span><span class="ls103">rn<span class="ff12 lsdf ws4c9"> the u</span></span>n<span class="ff12">ch<span class="_ _0"></span>a<span class="ff13">n</span><span class="ls12f ws64e">ged food value</span></span></div></div><div class="c xad y1517 wb1 h79"><div class="t m0 xc7 h14 y1518 ff12 fs7 fcb sc0 ls10c ws3d9">Calls the fo<span class="ff13 ls123 ws0">rm<span class="ff12 lsdc">atti</span><span class="ls6">n</span></span><span class="ls114 ws8d6">g fu<span class="ff13 ls6 ws0">n<span class="ff12 ls118">ctio</span>n</span></span></div><div class="t m0 x14b h14 y1519 ff12 fs7 fcb sc0 ls6 ws0">a<span class="ff13">n</span><span class="lsec">d </span><span class="ff13">r</span><span class="ls117">etu<span class="ff13 ls123">rn</span><span class="ls111 ws388">s its </span></span><span class="ff13">r</span><span class="ls10a">espo</span><span class="ff13">n</span><span class="ls119">se</span></div></div></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>
