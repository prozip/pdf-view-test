<div id="pfda" class="pf w0 h0" data-page-no="da"><div class="pc pcda w0 h0"><img class="bi x0 y0 w1 h1" alt="" src="bgda.png"/><div class="t m0 x42 h14 y80 ff7 fs7 fcb sc0 ls6 ws0">194</div><div class="t m0 x92 h2b y1cf ffb fs18 fcb sc0 ls6 ws0">C</div><div class="t m0 xd3 h2c y1d0 ffb fs19 fcb sc0 ls158 ws0">HAPTER</div><div class="t m0 xe4 h2b y1cf ffb fs18 fcb sc0 ls1bb ws730"> 10</div><div class="t m0 x2a h2d y80 ffa fs7 fcb sc0 ls6 ws0">Achieving loose coupling</div><div class="t m0 xc3 h3b y395 ffd fs18 fc3 sc0 lsb2 ws0">&apos;title&apos;:<span class="_"> </span>&apos;text<span class="_"> </span>not<span class="_"> </span>null&apos;,</div><div class="t m0 xc3 h3b y396 ffd fs18 fc3 sc0 lsb2 ws0">&apos;url&apos;:<span class="_"> </span>&apos;text<span class="_"> </span>not<span class="_"> </span>null&apos;,</div><div class="t m0 xc3 h3b y397 ffd fs18 fc3 sc0 lsb2 ws0">&apos;notes&apos;:<span class="_"> </span>&apos;text&apos;,</div><div class="t m0 xc3 h3b y40d ffd fs18 fc3 sc0 lsb2 ws0">&apos;date_added&apos;:<span class="_"> </span>&apos;text<span class="_"> </span>not<span class="_"> </span>null&apos;,</div><div class="t m0 x97 h3b y483 ffd fs18 fc3 sc0 lsb2 ws0">})</div><div class="t m0 xae h3b y569 ffd fs18 fc3 sc0 lsb2 ws0">def<span class="_"> </span>create(self,<span class="_"> </span>bookmark_data):</div><div class="t m0 x97 h3b y56a ffd fs18 fc3 sc0 lsb2 ws0">self.db.add(self.table_name,<span class="_"> </span>bookmark_data)</div><div class="t m0 xae h3b y487 ffd fs18 fc3 sc0 lsb2 ws0">def<span class="_"> </span>list(self,<span class="_"> </span>order_by=None):</div><div class="t m0 x97 h3b y58f ffd fs18 fc3 sc0 lsb2 ws0">return<span class="_"> </span>self.db.select(self.table_name,<span class="_"> </span>order_by=order_by).fetchall()</div><div class="t m0 xae h3b yfe2 ffd fs18 fc3 sc0 lsb2 ws0">def<span class="_"> </span>edit(self,<span class="_"> </span>bookmark_id,<span class="_"> </span>bookmark_data):</div><div class="t m0 x97 h3b y591 ffd fs18 fc3 sc0 lsb2 ws0">self.db.update(self.table_name,<span class="_"> </span>{&apos;id&apos;:<span class="_"> </span>bookmark_id},<span class="_"> </span>bookmark_data)</div><div class="t m0 xae h3b yc49 ffd fs18 fc3 sc0 lsb2 ws0">def<span class="_"> </span>delete(self,<span class="_"> </span>bookmark_id):</div><div class="t m0 x97 h3b y594 ffd fs18 fc1 sc0 lsb2 ws0">self.db.delete(self.table_name,<span class="_"> </span>{&apos;id&apos;:<span class="_"> </span>bookmark_id})</div><div class="t m0 x44 h15 y4e ff4 fsb fc3 sc0 ls6b ws527">Now that you have the interf<span class="_ _0"></span>ace for a pers<span class="ls2d ws1a8">istence layer and a specific implementation</span></div><div class="t m0 x44 h15 y4f ff4 fsb fc3 sc0 ls5e ws62d">of that interface that knows how<span class="_ _e"></span> to use </div><div class="t m5 x22 h24 y433 ffd fsc fc3 sc0 lsa0 ws0">DatabaseManag<span class="_ _e"></span>er</div><div class="t m0 x147 h15 y4f ff4 fsb fc3 sc0 ls9e ws95e"> to persist book<span class="_ _0"></span>marks, youâ€™re</div><div class="t m0 x44 h15 y2b2 ff4 fsb fc3 sc0 ls3e ws95f">ready to update your commands to depend on<span class="_ _0"></span> the </div><div class="t m5 x147 h24 y434 ffd fsc fc3 sc0 lsa0 ws0">PersistenceL<span class="_ _e"></span>ayer</div><div class="t m0 x107 h15 y2b2 ff4 fsb fc3 sc0 ls38 ws960"> interface</div><div class="t m0 x44 h15 yed ff4 fsb fc3 sc0 ls3a ws547">instead of </div><div class="t m5 x36 h24 y70a ffd fsc fc3 sc0 lsa0 ws0">DatabaseMan<span class="_ _e"></span>ager</div><div class="t m0 x24 h15 yed ff4 fsb fc3 sc0 ls34 ws3d5">. In the commands module, replace the </div><div class="t m5 x7d h24 y70a ffd fsc fc3 sc0 lsa0 ws0">db</div><div class="t m0 xaa h15 yed ff4 fsb fc3 sc0 ls2e ws90e"> instance of</div><div class="t m5 x44 h24 y14b7 ffd fsc fc3 sc0 lsa0 ws0">DatabaseManag<span class="_ _e"></span>er</div><div class="t m0 x28 h15 y52 ff4 fsb fc3 sc0 ls14c ws961"> with </div><div class="t m5 x3 h24 y14b7 ffd fsc fc3 sc0 lsa0 ws0">persistence</div><div class="t m0 xe h15 y52 ff4 fsb fc3 sc0 ls3e ws962">, an instance of </div><div class="t m5 x6e h24 y14b7 ffd fsc fc3 sc0 lsa0 ws0">BookmarkDataba<span class="_ _e"></span>se</div><div class="t m0 x96 h15 y52 ff4 fsb fc3 sc0 ls67 ws963">. Then go</div><div class="t m0 x44 h15 y53 ff4 fsb fc3 sc0 ls20 ws3e3">through the rest of the module, replacing calls to </div><div class="t m5 x14 h24 y14b8 ffd fsc fc3 sc0 lsa0 ws0">DatabaseMana<span class="_ _e"></span>ger</div><div class="t m0 x62 h15 y53 ff4 fsb fc3 sc0 ls1c5 ws215"> metho<span class="_ _0"></span>ds (lik<span class="_ _0"></span>e</div><div class="t m5 x44 h24 y15de ffd fsc fc3 sc0 lsa0 ws0">db.select</div><div class="t m0 x132 h15 y54 ff4 fsb fc3 sc0 ls5e ws34f">) with those from </div><div class="t m5 x69 h24 y15de ffd fsc fc3 sc0 lsa0 ws0">PersistenceL<span class="_ _e"></span>ayer</div><div class="t m0 xeb h15 y54 ff4 fsb fc3 sc0 ls180 ws964"> (like </div><div class="t m5 x6e h24 y15de ffd fsc fc3 sc0 lsa0 ws0">persistence<span class="_ _e"></span>.list</div><div class="t m0 x105 h15 y54 ff4 fsb fc3 sc0 ls159 ws965">). Refer to</div><div class="t m0 x44 h15 y199 ff4 fsb fc3 sc0 ls1c ws10">the following listing to check your work.</div><div class="t m0 x44 h3b y13ef ffd fs18 fc3 sc0 lsb2 ws0">from<span class="_"> </span>persistence<span class="_"> </span>import<span class="_"> </span>BookmarkDatabase</div><div class="t m0 x44 h3b y11a5 ffd fs18 fc3 sc0 lsb2 ws0">persistence<span class="_"> </span>=<span class="_"> </span>BookmarkDatabase()</div><div class="t m0 x44 h3b yec5 ffd fs18 fc3 sc0 lsb2 ws0">class<span class="_"> </span>AddBookmarkCommand(Command):</div><div class="t m0 xae h3b yec6 ffd fs18 fc3 sc0 lsb2 ws0">def<span class="_"> </span>execute(self,<span class="_"> </span>data,<span class="_"> </span>timestamp=None):</div><div class="t m0 x97 h3b y17ce ffd fs18 fc3 sc0 lsb2 ws0">data[&apos;date_added&apos;]<span class="_"> </span>=<span class="_"> </span>timestamp<span class="_"> </span>or<span class="_"> </span>datetime.utcnow().isoformat()</div><div class="t m0 x97 h3b y13ab ffd fs18 fc3 sc0 lsb2 ws0">persistence.create(data)</div><div class="t m0 x97 h3b y13ac ffd fs18 fc3 sc0 lsb2 ws0">return<span class="_"> </span>True,<span class="_"> </span>None</div><div class="t m0 x44 h3b y17cf ffd fs18 fc3 sc0 lsb2 ws0">class<span class="_"> </span>ListBookmarksCommand(Command):</div><div class="t m0 xae h3b y17d0 ffd fs18 fc3 sc0 lsb2 ws0">def<span class="_"> </span>__init__(self,<span class="_"> </span>order_by=&apos;date_added&apos;):</div><div class="t m0 x97 h3b y17d1 ffd fs18 fc3 sc0 lsb2 ws0">self.order_by<span class="_"> </span>=<span class="_"> </span>order_by</div><div class="t m0 xae h3b y1105 ffd fs18 fc3 sc0 lsb2 ws0">def<span class="_"> </span>execute(self,<span class="_"> </span>data=None):</div><div class="t m0 x97 h3b y118c ffd fs18 fc3 sc0 lsb2 ws0">return<span class="_"> </span>True,<span class="_"> </span>persistence.list(order_by=self.order_by)</div><div class="t m0 x44 h3b y503 ffd fs18 fc3 sc0 lsb2 ws0">class<span class="_"> </span>DeleteBookmarkCommand(Command):</div><div class="t m0 xae h3b yb43 ffd fs18 fc3 sc0 lsb2 ws0">def<span class="_"> </span>execute(self,<span class="_"> </span>data):</div><div class="t m0 x97 h3b y17d2 ffd fs18 fc3 sc0 lsb2 ws0">persistence.delete(data)</div><div class="t m0 x97 h3b y17d3 ffd fs18 fc3 sc0 lsb2 ws0">return<span class="_"> </span>True,<span class="_"> </span>None</div><div class="t m0 xad h20 y17d4 ffb fs7 fc4 sc0 ls6 ws0">Updating business logic to use abstraction<span class="_ _f5"></span>Listing<span class="_"> </span>10.11</div><div class="c x50 y17d5 wde h15e"><div class="t m0 x12e h14 y17d6 ff12 fs7 fcb sc0 lsd5 ws0">Database-specific </div><div class="t m0 x12e h14 y17d7 ff12 fs7 fcb sc0 ls6 ws0">i<span class="ff13">m</span><span class="lsde">ple</span><span class="ff13">m</span>e<span class="ff13">n</span><span class="ls181">tatio</span><span class="ff13">n</span><span class="ls123 ws795"> fo</span><span class="ff13">r</span> </div><div class="t m0 x12e h14 y15cf ff12 fs7 fcb sc0 lsee ws966">each of the behavio<span class="ff13 ls6 ws0">r<span class="ff12 ls119">s </span></span></div><div class="t m0 x12e h14 y15d0 ff12 fs7 fcb sc0 ls125 ws70c">of the i<span class="ff13 ls6 ws0">n<span class="ff12 ls146">te</span>r<span class="ff12 ls140">face</span></span></div></div><div class="c x6b y17d8 wdf h15f"><div class="t m0 x42 h14 ye96 ff12 fs7 fcb sc0 ls6 ws0">I<span class="ff13">m</span><span class="lsec">po</span><span class="ff13">r</span><span class="ls106 ws45d">ts Book</span><span class="ff13">m</span>a<span class="ff13">r</span><span class="lse4 ws318">ksDatabase i</span><span class="ff13">n</span> </div><div class="t m0 x42 h14 y17d9 ff12 fs7 fcb sc0 ls102 ws319">place of DatabaseMa<span class="ff13 ls6 ws0">n<span class="ff12 ls122">age</span>r</span></div></div><div class="c x56 y17da we0 h160"><div class="t m0 x42 h14 yc27 ff12 fs7 fcb sc0 lsde ws3cf">Sets up the pe<span class="ff13 ls6 ws0">r<span class="ff12 ls170">siste</span>n</span><span class="ls125 ws3cc">ce laye<span class="ff13 ls6 ws0">r</span><span class="lsd9 ws2ce"> (This </span></span></div><div class="t m0 x42 h14 yc28 ff12 fs7 fcb sc0 ls6 ws0">ca<span class="ff13">n</span><span class="lsd6 ws3da"> be swapped i</span><span class="ff13">n</span><span class="lsda ws2aa"> the futu</span><span class="ff13">r</span><span class="ls10d">e.)</span></div></div><div class="c x47 y17db wac hb3"><div class="t m0 x42 h14 y4aa ff12 fs7 fcb sc0 lsec ws0">pe<span class="ff13 ls6">r</span><span class="ls127">siste<span class="ff13 ls6">n</span></span>ce.c<span class="ff13 ls6">r</span><span class="ls10a ws470">eate takes </span></div><div class="t m0 x42 h14 y936 ff12 fs7 fcb sc0 lsde ws2ad">the place of db.add.</div></div><div class="c x103 y17dc we1 h161"><div class="t m0 x13c h14 y8ac ff12 fs7 fcb sc0 lsec ws0">pe<span class="ff13 ls6">r</span><span class="ls119">siste<span class="ff13 ls6">n</span><span class="lsde ws3cf">ce.list takes</span></span></div><div class="t m0 xb7 h14 y17dd ff12 fs7 fcb sc0 lsdc ws2ac">the place of db.select.</div></div><div class="c xca y17de wab h56"><div class="t m0 x12e h14 y8ad ff12 fs7 fcb sc0 lsec ws0">pe<span class="ff13 ls6">r</span><span class="ls170">siste<span class="ff13 ls6">n</span><span class="lse0 ws389">ce.delete takes </span></span></div><div class="t m0 x12e h14 y8ae ff12 fs7 fcb sc0 lsfd ws310">the place of db.delete.</div></div></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>
