<div id="pf85" class="pf w0 h0" data-page-no="85"><div class="pc pc85 w0 h0"><img class="bi x0 y0 w1 h1" alt="" src="bg85.png"/><div class="t m0 xa0 h14 y80 ff7 fs7 fcb sc0 ls6 ws0">109<span class="_ _aa"></span><span class="ffa">An initial code structure, by concern</span></div><div class="t m0 x35 h30 y857 ffb fsc fc2 sc0 ls6 ws0">E</div><div class="t m0 xbc h5a y858 ffb fs20 fc2 sc0 ls1b3 ws0">XECUTING</div><div class="t m0 xaf h30 y857 ffb fsc fc2 sc0 ls6 ws0"> </div><div class="t m0 x15 h5a y858 ffb fs20 fc2 sc0 ls1b4 ws0">STATEMENTS</div><div class="t m0 x35 h15 y859 ff4 fsb fc3 sc0 ls52 ws0">Your </div><div class="t m5 x4 h24 yd82 ffd fsc fc3 sc0 lsa0 ws0">DatabaseManag<span class="_ _e"></span>er</div><div class="t m0 x3b h15 y859 ff4 fsb fc3 sc0 ls3a ws1b4"> will need a way to execute statements. These statements have a</div><div class="t m0 x35 h15 y85b ff4 fsb fc3 sc0 ls62 ws708">couple of thin<span class="_ _e"></span>gs in common, so encaps<span class="_ _e"></span>ul<span class="ls34 ws323">ating those aspects into a reusable method</span></div><div class="t m0 x35 h15 y63b ff4 fsb fc3 sc0 ls35 ws34b">will reduce the likelihood of errors fr<span class="_ _0"></span>om re<span class="ls2d ws177">writing the same code each time you want</span></div><div class="t m0 x35 h15 y85c ff4 fsb fc3 sc0 ls3b ws29">to execute a new kind of statement.</div><div class="t m0 x83 h15 y85d ff4 fsb fc3 sc0 ls3d ws61"> Some SQL statements re<span class="_ _e"></span>turn data; these statements are called <span class="ff3 ls80 ws0">queries</span><span class="ls2f ws26a">. Sqlite3 man-</span></div><div class="t m0 x35 h15 y85e ff4 fsb fc3 sc0 ls5f ws59">ages query r<span class="_ _0"></span>esults with<span class="ls3d ws2c"> a concept called a <span class="ff3 ls25 ws0">cursor</span><span class="ls20 ws51">. Using a cursor to execute a statement</span></span></div><div class="t m0 x35 h15 y85f ff4 fsb fc3 sc0 ls5e ws594">lets you iterate over the results it returns. Statements that aren’t queries (</div><div class="t m5 x2c h24 yd83 ffd fsc fc3 sc0 lsa0 ws0">INSERT</div><div class="t m0 x122 h15 y85f ff4 fsb fc3 sc0 ls6 ws0">,</div><div class="t m5 x35 h24 yd84 ffd fsc fc3 sc0 lsa0 ws0">DELETE</div><div class="t m0 x20 h15 yd85 ff4 fsb fc3 sc0 ls31 ws21c">, and so on) don’t return any results, bu<span class="ls1c ws82">t the cursor m<span class="_ _e"></span>anages this by returning</span></div><div class="t m0 x35 h15 yd86 ff4 fsb fc3 sc0 ls81 ws148">an empty list.</div><div class="t m0 x83 h15 yd87 ff4 fsb fc3 sc0 ls2c ws709"> Write an </div><div class="t m5 xe6 h24 yd88 ffd fsc fc3 sc0 lsa0 ws0">_execute</div><div class="t m0 xbe h15 yd87 ff4 fsb fc3 sc0 ls71 ws302"> method on </div><div class="t m5 xa9 h24 yd88 ffd fsc fc3 sc0 lsa0 ws0">DatabaseMan<span class="_ _e"></span>ager</div><div class="t m0 xee h15 yd87 ff4 fsb fc3 sc0 ls30 ws32c"> that you can use to exe<span class="_ _e"></span>cute all</div><div class="t m0 x35 h15 yd89 ff4 fsb fc3 sc0 ls71 ws10a">statements using a cursor, returning a resu<span class="ls6c ws70a">lt that you can choose t<span class="_ _0"></span>o use where you</span></div><div class="t m0 x35 h15 yd8a ff4 fsb fc3 sc0 ls20 ws51">need to. The </div><div class="t m5 x38 h24 yd8b ffd fsc fc3 sc0 lsa0 ws0">_execute</div><div class="t m0 x3b h15 yd8c ff4 fsb fc3 sc0 ls34 ws9f"> method should</div><div class="t m0 x8a h3d yd8d ffb fs1e fca sc0 ls6 ws0">1</div><div class="t m0 x48 h15 yd8e ff4 fsb fc3 sc0 ls34 ws9f">Accept a statement as<span class="ls38 ws26"> a string argument</span></div><div class="t m0 x8a h3d yd8f ffb fs1e fca sc0 ls6 ws0">2</div><div class="t m0 x48 h15 y4b3 ff4 fsb fc3 sc0 ls7a ws2c3">Get a cursor from t<span class="_ _0"></span>he database connec<span class="_ _0"></span>tion</div><div class="t m0 x8a h3d yd90 ffb fs1e fca sc0 ls6 ws0">3</div><div class="t m0 x48 h15 yd91 ff4 fsb fc3 sc0 ls20 ws51">Execute a statement using the cu<span class="_ _e"></span>rsor (more on this shortly)</div><div class="t m0 x8a h3d yd92 ffb fs1e fca sc0 ls6 ws0">4</div><div class="t m0 x48 h15 yba7 ff4 fsb fc3 sc0 ls71 ws70b">Return the cursor, which has stored the result of th<span class="_ _e"></span>e executed statement</div><div class="t m0 x48 h15 yba8 ff4 fsb fc3 sc0 ls42 ws32">(if any)</div><div class="t m0 x35 h3b yd93 ffd fs18 fc3 sc0 lsb2 ws0">def<span class="_"> </span>_execute(self,<span class="_"> </span>statement):</div><div class="t m0 x87 h3b yd94 ffd fs18 fc3 sc0 lsb2 ws0">cursor<span class="_"> </span>=<span class="_"> </span>self.connection.cursor()</div><div class="t m0 x87 h3b yd95 ffd fs18 fc3 sc0 lsb2 ws0">cursor.execute(statement)</div><div class="t m0 x87 h3b yd96 ffd fs18 fc3 sc0 lsb2 ws0">return<span class="_"> </span>cursor</div><div class="t m0 x35 h15 yd97 ff4 fsb fc3 sc0 ls20 ws478">Statements that aren’t queries usually mani<span class="ls44 wsda">pulate data, and if anything bad happens</span></div><div class="t m0 x35 h15 yd98 ff4 fsb fc3 sc0 ls3a ws20e">while they’re executing, the data could <span class="ls31 ws2b7">become corrupted. Databases guard against</span></div><div class="t m0 x35 h15 yd99 ff4 fsb fc3 sc0 ls31 ws2b7">this with a feature called a <span class="ff3 ls1b ws0">transaction</span><span class="ls3a ws20e">. If a statement executing within a transaction</span></div><div class="t m0 x35 h15 yd9a ff4 fsb fc3 sc0 ls31 ws1fd">fails or is otherwise interrupted, the database<span class="lsc9 ws0"> w<span class="_ _1c"></span>i<span class="_ _1d"></span>l<span class="_ _1d"></span>l<span class="_ _1d"></span> r<span class="_ _1d"></span>o<span class="_ _1d"></span>l<span class="_ _1d"></span>l<span class="_ _1d"></span> b<span class="_ _1c"></span>a<span class="_ _1d"></span>c<span class="_ _0"></span>k<span class="_ _1c"></span> t<span class="_ _1d"></span>o<span class="_ _1d"></span> i<span class="_ _1d"></span>t<span class="_ _1d"></span>s<span class="_ _1d"></span> l<span class="_ _1d"></span>a<span class="_ _1d"></span>s<span class="_ _1d"></span>t<span class="_ _1d"></span> k<span class="_ _1d"></span>n<span class="_ _1d"></span>o<span class="_ _1d"></span>w<span class="_ _1d"></span>n<span class="_ _1d"></span> w<span class="_ _1c"></span>o<span class="_ _0"></span>r<span class="_ _1c"></span>k<span class="_ _1d"></span>i<span class="_ _1d"></span>n<span class="_ _1d"></span>g</span></div><div class="t m0 x35 h15 y7d6 ff4 fsb fc3 sc0 ls21 ws12b">state. Sqlit<span class="_ _0"></span>e3 lets you use the<span class="_ _0"></span> connection objec<span class="_ _0"></span>t to create a transa<span class="_ _0"></span>ction via a <span class="ff3 ls3a ws0">context</span></div><div class="t m0 x35 h15 y7d7 ff3 fsb fc3 sc0 ls36 ws0">manager<span class="ff4 ls38 ws424">, a Python block using the </span></div><div class="t m5 x94 h24 yd9b ffd fsc fc3 sc0 lsa0 ws0">with</div><div class="t m0 x27 h15 y7d7 ff4 fsb fc3 sc0 ls3a ws74"> keyword that provides some special be<span class="_ _e"></span>havior</div><div class="t m0 x35 h15 yd9c ff4 fsb fc3 sc0 ls80 ws409">when the code enters and exits the block.</div><div class="t m0 x83 h15 y8f3 ff4 fsb fc3 sc0 ls1f ws45"> Update </div><div class="t m5 xc3 h24 yd9d ffd fsc fc3 sc0 lsa0 ws0">_execute</div><div class="t m0 x92 h15 y8f3 ff4 fsb fc3 sc0 ls3a ws1e0"> to put the </div><div class="t m5 x2a h24 yd9d ffd fsc fc3 sc0 lsa0 ws0">cursor</div><div class="t m0 x4e h15 y8f3 ff4 fsb fc3 sc0 ls50 ws379"> creation, execution,<span class="_ _0"></span> and return inside a trans-</div><div class="t m0 x35 h15 yd9e ff4 fsb fc3 sc0 ls44 ws53">action, like the foll<span class="_ _0"></span>owing:</div><div class="t m0 x35 h3b yd9f ffd fs18 fc3 sc0 lsb2 ws0">def<span class="_"> </span>_execute(self,<span class="_"> </span>statement):</div><div class="t m0 x87 h3b yda0 ffd fs18 fc3 sc0 lsb2 ws0">with<span class="_"> </span>self.connection:</div><div class="t m0 x36 h3b yda1 ffd fs18 fc3 sc0 lsb2 ws0">cursor<span class="_"> </span>=<span class="_"> </span>self.connection.cursor()</div><div class="t m0 x36 h3b yda2 ffd fs18 fc3 sc0 lsb2 ws0">cursor.execute(statement)</div><div class="t m0 x36 h3b yda3 ffd fs18 fc3 sc0 lsb2 ws0">return<span class="_"> </span>cursor</div><div class="t m0 x35 h15 yda4 ff4 fsb fc3 sc0 ls5f ws0">Using </div><div class="t m5 x97 h24 yda5 ffd fsc fc3 sc0 lsa0 ws0">.execute</div><div class="t m0 xa7 h15 yda4 ff4 fsb fc3 sc0 ls34 ws143"> inside a transaction will get you where you <span class="_ _e"></span>need to go, functionally</div><div class="t m0 x35 h15 yda6 ff4 fsb fc3 sc0 ls38 ws3c6">speaking. But it’s a good secu<span class="ls20 ws621">rity practice to use placeholders for real values in SQL</span></div><div class="c x34 yda7 w5d hc9"><div class="t m0 xfb h14 yda8 ff12 fs7 fcb sc0 ls6 ws0">C<span class="ff13">r</span><span class="lsde ws3cf">eates the cu</span><span class="ff13">r</span><span class="ls119">so</span><span class="ff13">r</span></div></div><div class="c x63 yda9 w29 h78"><div class="t m0 x12e h14 ydaa ff12 fs7 fcb sc0 ls6 ws317">Uses the cu<span class="ff13 ws0">r<span class="ff12 ls10e">so</span>r</span><span class="ls125 ws70c"> to execute </span></div><div class="t m0 x12e h14 ydab ff12 fs7 fcb sc0 lsed ws5bd">the SQL state<span class="ff13 ls6 ws0">m<span class="ff12">e</span>n<span class="ff12">t</span></span></div></div><div class="c xd0 ydac w9 h79"><div class="t m0 x12e h14 y65c ff12 fs7 fcb sc0 lse0 ws0">Retu<span class="ff13 ls103">rn</span><span class="lsd5 ws70d">s the cu</span><span class="ff13 ls6">r</span><span class="ls10e">so<span class="ff13 ls6">r</span><span class="ls170 ws70e">, which </span></span></div><div class="t m0 x12e h14 ydad ff12 fs7 fcb sc0 lsd6 ws2a7">has sto<span class="ff13 ls6 ws0">r</span><span class="lsda ws2aa">ed the <span class="ff13 ls6 ws0">r<span class="ff12 lsee">esults</span></span></span></div></div><div class="c xd0 ydae w9 h79"><div class="t m0 x12e h14 y9fb ff12 fs7 fcb sc0 ls164 ws70f">This c<span class="ff13 ls6 ws0">r</span><span class="ls106 ws326">eates a database </span></div><div class="t m0 x12e h14 ydaf ff12 fs7 fcb sc0 ls6 ws0">t<span class="ff13">r</span>a<span class="ff13">n</span><span class="ls106">sactio</span><span class="ff13">n</span><span class="ls102 ws3cd"> co</span><span class="ff13">n</span><span class="lsd6">text.</span></div></div><div class="c x22 ydb0 w9 hb7"><div class="t m0 x12e h14 ydb1 ff12 fs7 fcb sc0 lsda ws311">This happe<span class="ff13 ls6 ws0">n</span><span class="lsd7 ws2a8">s withi<span class="ff13 ls6 ws0">n</span><span class="lsed ws4ed"> th<span class="_ _0"></span>e </span></span></div><div class="t m0 x12e h14 ydb2 ff12 fs7 fcb sc0 lsd5 ws2a6">database t<span class="ff13 ls6 ws0">r<span class="ff12">a</span>n<span class="ff12 ls111">sactio</span>n<span class="ff12">.</span></span></div></div></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>
