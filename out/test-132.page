<div id="pf84" class="pf w0 h0" data-page-no="84"><div class="pc pc84 w0 h0"><img class="bi x0 y0 w1 h1" alt="" src="bg84.png"/><div class="t m0 x42 h14 y80 ff7 fs7 fcb sc0 ls6 ws0">108</div><div class="t m0 x66 h2b y1cf ffb fs18 fcb sc0 ls6 ws0">C</div><div class="t m0 x8e h2c y1d0 ffb fs19 fcb sc0 ls185 ws0">HAPTER</div><div class="t m0 xf1 h2b y1cf ffb fs18 fcb sc0 ls8c ws0"> 6</div><div class="t m0 xe4 h2d y80 ffa fs7 fcb sc0 ls6 ws0">Separation of concerns in practice</div><div class="t m0 x44 h15 y40 ff4 fsb fc3 sc0 ls1c ws151">SQL statement and exe<span class="_ _e"></span>cuting it. Executing it requires a connection to the database,</div><div class="t m0 x44 h15 y41 ff4 fsb fc3 sc0 ls42 ws32">which requires the path to the database file.</div><div class="t m0 x32 h15 y42 ff4 fsb fc3 sc0 ls34 ws42d"> Whereas managing the persistence is a hi<span class="ls20 ws43e">gh-level concern, these individual con-</span></div><div class="t m0 x44 h15 y43 ff4 fsb fc3 sc0 ls42 ws27b">cerns are what you get when you peel open <span class="ls71 ws1cc">the persistence layer. They should each be</span></div><div class="t m0 x44 h15 y44 ff4 fsb fc3 sc0 ls66 ws69">separate as well. Fir<span class="_ _0"></span>st things first,<span class="_ _0"></span> thou<span class="ls2d ws1d">gh—you need a connecti<span class="_ _0"></span>on to the database.</span></div><div class="t m0 x44 h30 yd50 ffb fsc fc2 sc0 ls6 ws0">C</div><div class="t m0 x12c h5a yd51 ffb fs20 fc2 sc0 ls1ab ws0">REATING</div><div class="t m0 x48 h30 yd50 ffb fsc fc2 sc0 ls6 ws0"> </div><div class="t m0 x20 h5a yd51 ffb fs20 fc2 sc0 ls1ac ws0">AND</div><div class="t m0 x21 h30 yd50 ffb fsc fc2 sc0 ls6 ws0"> </div><div class="t m0 xc3 h5a yd51 ffb fs20 fc2 sc0 ls1ad ws0">CLOSING</div><div class="t m0 xd1 h30 yd50 ffb fsc fc2 sc0 ls6 ws0"> </div><div class="t m0 x8e h5a yd51 ffb fs20 fc2 sc0 ls1ae ws0">THE</div><div class="t m0 xd3 h30 yd50 ffb fsc fc2 sc0 ls6 ws0"> </div><div class="t m0 xbe h5a yd51 ffb fs20 fc2 sc0 ls11d ws0">DATABASE</div><div class="t m0 xfe h30 yd50 ffb fsc fc2 sc0 ls6 ws0"> </div><div class="t m0 x2a h5a yd51 ffb fs20 fc2 sc0 ls1af ws0">CONNECTI<span class="_ _0"></span>ON</div><div class="t m0 x44 h15 yd52 ff4 fsb fc3 sc0 ls2f ws5db">While Bark is running, it needs only one connection to the database—it can reuse this</div><div class="t m0 x44 h15 yd53 ff4 fsb fc3 sc0 ls2f ws6f2">connection for all its operations. To <span class="ls3e ws2fa">make this connection, you can use </span></div><div class="t m5 xab h24 yd54 ffd fsc fc3 sc0 lsa0 ws0">sqlite3</div><div class="t m5 x44 h24 yd55 ffd fsc fc3 sc0 lsa0 ws0">.connect</div><div class="t m0 xef h15 yd56 ff4 fsb fc3 sc0 ls51 ws218">, which accepts the path of the database file to which it should connect.</div><div class="t m0 x44 h15 yd57 ff4 fsb fc3 sc0 ls1b ws40">Again, if the file do<span class="_ _e"></span>es not <span class="ls2f ws26a">exist, it will be created.</span></div><div class="t m0 x32 h15 yd58 ff4 fsb fc3 sc0 ls3d ws2c"> The </div><div class="t m5 x102 h24 yd59 ffd fsc fc3 sc0 lsa0 ws0">__init__</div><div class="t m0 x28 h15 yd58 ff4 fsb fc3 sc0 ls129 ws5a3"> for </div><div class="t m5 xb1 h24 yd59 ffd fsc fc3 sc0 lsa0 ws0">DatabaseManag<span class="_ _e"></span>er</div><div class="t m0 x22 h15 yd58 ff4 fsb fc3 sc0 ls1c ws21"> should</div><div class="t m0 xbc h3d yd5a ffb fs1e fca sc0 ls6 ws0">1</div><div class="t m0 x87 h15 yd5b ff4 fsb fc3 sc0 ls21 ws6f3">Accept an argu<span class="_ _0"></span>ment containing the<span class="_ _0"></span> path to the d<span class="_ _0"></span>atabase file (Don’t<span class="_ _0"></span> hardcode</div><div class="t m0 x87 h15 yd5c ff4 fsb fc3 sc0 ls3a ws1e0">it; separate your concerns!)</div><div class="t m0 xbc h3d yd5d ffb fs1e fca sc0 ls6 ws0">2</div><div class="t m0 x87 h15 y73 ff4 fsb fc3 sc0 ls3d ws6f4">Use the database file path to <span class="_ _e"></span>create a SQLite connection using </div><div class="t m5 xab h24 yd5e ffd fsc fc3 sc0 lsa0 ws0">sqlite3</div><div class="t m5 x87 h24 yd5f ffd fsc fc3 sc0 lsa0 ws0">.connect(path<span class="_ _e"></span>)</div><div class="t m0 xb9 h15 yd60 ff4 fsb fc3 sc0 ls2d ws31"> and store it as an instance attribute</div><div class="t m0 x44 h15 yd61 ff4 fsb fc3 sc0 ls20 ws478">It’s good practice to close the connection to the SQLite database when the program</div><div class="t m0 x44 h15 yd62 ff4 fsb fc3 sc0 ls6c ws6f5">finishes, to limi<span class="_ _0"></span>t the possibility of d<span class="_ _0"></span>ata corruption. Fo<span class="_ _0"></span>r symmetry, the </div><div class="t m5 xaa h24 yd63 ffd fsc fc3 sc0 lsa0 ws0">__del__</div><div class="t m0 x11f h15 yd62 ff4 fsb fc3 sc0 lsbc ws6f6"> for</div><div class="t m5 x44 h24 yd64 ffd fsc fc3 sc0 lsa0 ws0">DatabaseManag<span class="_ _e"></span>er</div><div class="t m0 x28 h15 yd65 ff4 fsb fc3 sc0 ls2c ws6f7"> should close the connect<span class="ls3e ws6f8">ion with the connection’s </span></div><div class="t m5 x115 h24 yd64 ffd fsc fc3 sc0 lsa0 ws0">.close()</div><div class="t m0 x9a h15 yd65 ff4 fsb fc3 sc0 ls44 ws6f9"> method.</div><div class="t m0 x32 h15 yd66 ff4 fsb fc3 sc0 ls42 ws32"> This will serve as the foundation for executing st<span class="_ _e"></span>atements.</div><div class="t m0 x44 h3b yd67 ffd fs18 fc3 sc0 lsb2 ws0">import<span class="_"> </span>sqlite3</div><div class="t m0 x44 h3b yd68 ffd fs18 fc3 sc0 lsb2 ws0">class<span class="_"> </span>DatabaseManager:</div><div class="t m0 xae h3b yd69 ffd fs18 fc3 sc0 lsb2 ws0">def<span class="_"> </span>__init__(self,<span class="_"> </span>database_filename):</div><div class="t m0 x97 h3b yd6a ffd fs18 fc3 sc0 lsb2 ws0">self.connection<span class="_"> </span>=<span class="_"> </span>sqlite3.connect(database_filename)</div><div class="t m0 xae h3b yd6b ffd fs18 fc3 sc0 lsb2 ws0">def<span class="_"> </span>__del__(self):</div><div class="t m0 x97 h3b yd6c ffd fs18 fc3 sc0 lsb2 ws0">self.connection.close()</div><div class="c x44 yd6d w2 hc7"><div class="t m0 xb7 h2f yd6e ffb fs15 fc2 sc0 ls164 ws468">Working wit<span class="_ _0"></span>h database<span class="_ _0"></span>s</div><div class="t m0 xb7 h30 yd6f fff fsc fc3 sc0 lsca ws6fa">Many smart people ha<span class="_ _e"></span>ve produced wonderful and robu<span class="_ _e"></span>st packages that make work<span class="_ _e"></span>ing</div><div class="t m0 xb7 h30 yd70 fff fsc fc3 sc0 lsd0 ws6fb">with databases in Python<span class="_ _e"></span> easier. SQLAlchemy (<span class="fcc ws0">www.sqlalchemy.o<span class="_ _e"></span>rg</span><span class="lsb9 ws6fc">) is a w<span class="_ _0"></span>idely used</span></div><div class="t m0 xb7 h30 yd71 fff fsc fc3 sc0 lsd0 ws6fd">tool for not only inte<span class="_ _e"></span>racting with datab<span class="lsca ws6fa">ases, but abstracting data mode<span class="_ _e"></span>ls via <span class="_ _0"></span>an <span class="ff10 ls1b0 ws0">object-</span></span></div><div class="t m0 xb7 h30 yd72 ff10 fsc fc3 sc0 ls9b ws6fe">relational mapping<span class="fff ls1b1 ws6ff"> (ORM). A<span class="_ _0"></span>n ORM allows you to tre<span class="_ _0"></span><span class="ls188 ws700">at database record<span class="_ _e"></span>s as objects</span></span></div><div class="t m0 xb7 h30 yd73 fff fsc fc3 sc0 lsce ws701">in languages like Py<span class="_ _0"></span>thon, without wo<span class="_ _0"></span>rrying much about th<span class="_ _0"></span>e details of a datab<span class="_ _0"></span>ase at</div><div class="t m0 xb7 h30 yd74 fff fsc fc3 sc0 lsca wsb">all. The Djang<span class="_ _e"></span>o web framework also provid<span class="_ _e"></span>es an ORM for writing d<span class="_ _e"></span>ata models.</div><div class="t m0 xb7 h30 yd75 fff fsc fc3 sc0 ls188 ws5dc">In the spirit of<span class="_ _e"></span> learning by doing, you’ll w<span class="_ _e"></span>rite the database interactio<span class="_ _e"></span>n code yourself</div><div class="t m0 xb7 h30 yd76 fff fsc fc3 sc0 ls190 ws702">in this chapter.<span class="_ _0"></span> It’s limited to the scope o<span class="_ _0"></span>f Bark, but it can be adde<span class="_ _0"></span>d to or replaced if</div><div class="t m0 xb7 h30 yd77 fff fsc fc3 sc0 ls165 ws539">you’d like to do more with the<span class="_ _e"></span> rest of the application. If you need to <span class="_ _e"></span>use a database</div><div class="t m0 xb7 h30 yd78 fff fsc fc3 sc0 ls17d ws703">in future <span class="_ _0"></span>projects, cons<span class="_ _0"></span>ider whethe<span class="_ _0"></span>r you want t<span class="_ _0"></span>o write your<span class="_ _0"></span> database code<span class="_ _0"></span> from scratch</div><div class="t m0 xb7 h30 yd79 fff fsc fc3 sc0 ls188 ws704">or use one of these third-party<span class="_ _e"></span> <span class="_ _0"></span>packages instead.</div></div><div class="c xcb yd7a w5c hc8"><div class="t m0 x12e h14 yd7b ff12 fs7 fcb sc0 ls6 ws0">C<span class="ff13">r</span><span class="ls106 ws45d">eates a</span><span class="ff13">n</span><span class="ls13e ws705">d sto</span><span class="ff13">r</span><span class="lsd9">es </span></div><div class="t m0 x12e h14 yd7c ff12 fs7 fcb sc0 ls100 ws706">a co<span class="ff13 ls1b2 ws0">nn<span class="ff12 lsef">ectio</span><span class="ls6">n</span></span><span class="lsd5 ws707"> to the </span></div><div class="t m0 x12e h14 yd7d ff12 fs7 fcb sc0 ls105 ws325">database fo<span class="ff13 ls6 ws0">r</span><span class="lsd2 ws38c"> late<span class="ff13 ls6 ws0">r<span class="ff12"> </span></span></span></div><div class="t m0 x12e h14 yd7e ff12 fs7 fcb sc0 lsff ws0">use</div></div><div class="c xca yd7f w9 h56"><div class="t m0 x12e h14 yd80 ff12 fs7 fcb sc0 lsfd ws0">Clea<span class="ff13 ls6">n</span><span class="lsde ws2ad">s up the co</span><span class="ff13 ls145">nn</span><span class="lsef">ectio<span class="ff13 ls6">n<span class="ff12"> </span></span></span></div><div class="t m0 x12e h14 yd81 ff12 fs7 fcb sc0 ls105 ws0">whe<span class="ff13 ls6">n</span><span class="ls181 ws5be"> do</span><span class="ff13 ls6">n</span><span class="lsee ws30e">e, to be safe</span></div></div><a class="l" href="https://www.sqlalchemy.org/"><div class="d m2" style="border-style:none;position:absolute;left:298.500000px;bottom:493.358000px;width:83.700000px;height:10.500000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>
