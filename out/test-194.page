<div id="pfc2" class="pf w0 h0" data-page-no="c2"><div class="pc pcc2 w0 h0"><img class="bi x0 y0 w1 h1" alt="" src="bgc2.png"/><div class="t m0 x42 h14 y80 ff7 fs7 fcb sc0 ls6 ws0">170</div><div class="t m0 xb9 h2b y1cf ffb fs18 fcb sc0 ls6 ws0">C</div><div class="t m0 xd3 h2c y1d0 ffb fs19 fcb sc0 lsf6 ws0">HAPTER</div><div class="t m0 xd9 h2b y1cf ffb fs18 fcb sc0 ls8c ws0"> 9</div><div class="t m0 x1f h2d y80 ffa fs7 fcb sc0 ls6 ws0">Keeping things lightweight</div><div class="t m0 x44 h15 y40 ff4 fsb fc3 sc0 ls66 ws8d7">function. Tr<span class="_ _0"></span>y that out now and refe<span class="_ _0"></span>r to the followi<span class="_ _0"></span>ng listing when you’re<span class="_ _0"></span> done to</div><div class="t m0 x44 h15 y41 ff4 fsb fc3 sc0 ls4e ws1e3">check your work.</div><div class="t m0 x44 h3b y10aa ffd fs18 fc3 sc0 lsb2 ws0">def<span class="_"> </span>get_format_function(accept=None):</div><div class="t m0 xae h3b y10ab ffd fs18 fc3 sc0 lsb2 ws0">formats<span class="_"> </span>=<span class="_"> </span>{</div><div class="t m0 x97 h3b y10ac ffd fs18 fc3 sc0 lsb2 ws0">&apos;application/json&apos;:<span class="_"> </span>to_json,</div><div class="t m0 x97 h3b y10ad ffd fs18 fc3 sc0 lsb2 ws0">&apos;application/xml&apos;:<span class="_"> </span>to_xml,</div><div class="t m0 xae h3b y10ae ffd fs18 fc3 sc0 ls6 ws0">}</div><div class="t m0 xae h3b y151a ffd fs18 fc3 sc0 lsb2 ws0">return<span class="_"> </span>formats.get(accept,<span class="_"> </span>lambda<span class="_"> </span>val:<span class="_"> </span>val)</div><div class="t m0 x44 h3b y151b ffd fs18 fc3 sc0 lsb2 ws0">def<span class="_"> </span>random_food(request):</div><div class="t m0 xae h3b y151c ffd fs18 fc3 sc0 lsb2 ws0">food<span class="_"> </span>=<span class="_"> </span>random.choice(FOODS)</div><div class="t m0 xae h3b y151d ffd fs18 fc3 sc0 lsb2 ws0">format_function<span class="_"> </span>=<span class="_"> </span>get_format_function(request.headers.get(&apos;Accept&apos;))</div><div class="t m0 xae h3b y151e ffd fs18 fc3 sc0 lsb2 ws0">return<span class="_"> </span>format_function(food)</div><div class="t m0 x44 h15 y1430 ff4 fsb fc3 sc0 ls47 ws8d8">You may be thinking this code is more co<span class="_ _e"></span><span class="ls20 ws66e">mplex; you now have fo<span class="ls71 ws3c0">ur functions compared</span></span></div><div class="t m0 x44 h15 y1431 ff4 fsb fc3 sc0 ls36 ws2e7">to your initial one. But you’ve achi<span class="_ _0"></span>eved so<span class="ls20 ws251">mething here: each of these functions has a</span></div><div class="t m0 x44 h15 y1432 ff4 fsb fc3 sc0 ls71 ws83">cyclomatic complexity of 1, is quite readab<span class="ls2f ws23">le, and has a nice separation of concerns.</span></div><div class="t m0 x32 h15 y1202 ff4 fsb fc3 sc0 ls30 ws32e"> You’ve also got something <span class="ff3 ls5b ws0">exte<span class="_ _e"></span>nsible</span><span class="ls51 ws10c"> on your hands, because when you need to han-</span></div><div class="t m0 x44 h15 y151f ff4 fsb fc3 sc0 ls20 ws51">dle new response formats, <span class="ls38 ws26">the process is as follows:</span></div><div class="t m0 xbc h3d y1520 ffb fs1e fca sc0 ls6 ws0">1</div><div class="t m0 x87 h15 y1521 ff4 fsb fc3 sc0 ls3d ws61">Add a new function to format the response as desired.</div><div class="t m0 xbc h3d y1522 ffb fs1e fca sc0 ls6 ws0">2</div><div class="t m0 x87 h15 y1523 ff4 fsb fc3 sc0 ls42 wsde">Add the mapping of the required </div><div class="t m5 xa1 h24 y1524 ffd fsc fc3 sc0 lsa0 ws0">Accept</div><div class="t m0 x74 h15 y1523 ff4 fsb fc3 sc0 ls1c ws165"> header value to the new formatting</div><div class="t m0 x87 h15 y1525 ff4 fsb fc3 sc0 ls1c ws0">function.</div><div class="t m0 xbc h3d y1526 ffb fs1e fca sc0 ls6 ws0">3</div><div class="t m0 x87 h15 y2db ff4 fsb fc3 sc0 ls14a ws0">Profit.</div><div class="t m0 x44 h15 y1527 ff4 fsb fc3 sc0 ls42 ws502">You can create new business value just by<span class="ls21 ws3f4"> adding new code and updating confi<span class="_ _0"></span>gura-</span></div><div class="t m0 x44 h15 y329 ff4 fsb fc3 sc0 ls4e ws1e3">tion. This is the ideal.</div><div class="t m0 x32 h15 y32a ff4 fsb fc3 sc0 ls3d ws2c"> Now that you know some tricks fo<span class="_ _e"></span>r function<span class="ls71 wsd4">s, I want to show you a few for classes. </span></div><div class="t m0 x42 h1f y1528 ffc fs13 fc2 sc0 ls84 ws8d9">9<span class="_ _0"></span>.<span class="_ _1d"></span>3<span class="_ _21"> </span>Decomposing classes</div><div class="t m0 x44 h15 y32d ff4 fsb fc3 sc0 ls71 ws4c2">Classes can grow unruly like functions, and <span class="_ _e"></span><span class="ls44 ws51f">perhaps at a faster rate. But it feels some-</span></div><div class="t m0 x44 h15 y14f3 ff4 fsb fc3 sc0 ls2d ws15b">how more scary to break down a class than it<span class="lsac ws8da"> does a function. Functi<span class="_ _0"></span>ons feel like bu<span class="_ _0"></span>ild-</span></div><div class="t m0 x44 h15 y1529 ff4 fsb fc3 sc0 lsac ws75d">ing blocks,<span class="_ _0"></span> but classes feel <span class="_ _0"></span><span class="ls5f ws4c0">like completed products. This <span class="_ _0"></span><span class="ls3a ws296">is a mental barrier I often</span></span></div><div class="t m0 x44 h15 y152a ff4 fsb fc3 sc0 ls35 ws24">struggle to<span class="ls34 ws9f"> suppress.</span></div><div class="t m0 x32 h15 y152b ff4 fsb fc3 sc0 ls1e ws11a"> You should have the confidence to deco<span class="ls31 ws378">mpose classes as frequently as functions.</span></div><div class="t m0 x44 h15 y1128 ff4 fsb fc3 sc0 ls31 ws300">Classes are just another tool at your disposal. When you find that a class starts growing</div><div class="t m0 x44 h15 y333 ff4 fsb fc3 sc0 ls36 wsd6">in complexity, it’s usually due to a mixing<span class="_ _0"></span><span class="ls42 ws3af"> of concerns. Once you identify a concern</span></div><div class="t m0 x44 h15 y152c ff4 fsb fc3 sc0 ls48 ws39">that feels like its own obje<span class="_ _e"></span>ct, you’ve got enough to start breaking it down.</div><div class="t m0 x37 h20 y10cf ffb fs7 fc4 sc0 ls6 ws0">Separating concerns into two functions<span class="_ _f4"></span>Listing<span class="_"> </span>9.5</div><div class="c x30 y10d1 w2c h43"><div class="t m0 xc8 h14 y2f2 ff12 fs7 fcb sc0 lsde ws0">Dete<span class="ff13 ls123">rm</span><span class="ls6">i<span class="ff13">n</span><span class="ls17f ws8db">es which fo</span><span class="ff13 ls123">rm</span><span class="ls10f">atti</span><span class="ff13">n</span><span class="lse1">g </span></span></div><div class="t m0 xc8 h14 y9b4 ff12 fs7 fcb sc0 ls123 ws0">fu<span class="ff13 ls6">n</span><span class="ls117">ctio<span class="_ _e"></span><span class="ff13 ls6">n</span><span class="lsda ws2aa"> to use</span></span></div></div><div class="c x3b y152d w28 hf0"><div class="t m0 x12e h14 y10e1 ff13 fs7 fcb sc0 ls6 ws0">r<span class="ff12">a</span>n<span class="ff12 lsec">do</span>m<span class="ff12 ws317">_food is th</span>r<span class="ff12">ee </span></div><div class="t m0 x12e h14 y65d ff12 fs7 fcb sc0 ls119 ws0">sho<span class="ff13 ls6">r</span><span class="lsee ws2cf">t steps </span><span class="ff13 ls6">n</span><span class="ls140">ow.</span></div></div><div class="c x98 y152e w3a h111"><div class="t m0 x12e h14 y152f ff12 fs7 fcb sc0 ls6 ws0">P<span class="ff13">r</span>eviously <span class="ff13">m</span><span class="lsdc ws2ac">ixed co</span><span class="ff13">n</span>ce<span class="ff13 ls103">rn</span><span class="ls119 ws3a3">s a</span><span class="ff13">r</span>e</div><div class="t m0 x125 h14 y1530 ff12 fs7 fcb sc0 ls17f ws0">abst<span class="ff13 ls6">r</span><span class="ls10c ws35a">acted to fu</span><span class="ff13 ls6">n</span><span class="lse4">ctio<span class="ff13 ls6">n</span><span class="ls13c ws45b"> calls </span><span class="ff13 ls6">n</span><span class="ls140">ow.</span></span></div></div></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>
